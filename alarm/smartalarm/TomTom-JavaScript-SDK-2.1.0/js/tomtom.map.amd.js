var JSON;JSON||(JSON={}),function(){function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),define("tomtom/lib/json2",function(){}),define("tomtom/Main",["./lib/json2"],function(){window.tomtom||(window.tomtom={}),window.tomtom.dom={},window.tomtom.layers={},window.tomtom.services={},window.tomtom.controls={},typeof String.prototype.trim!="function"&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(this===null||this===undefined)throw new TypeError;var t=Object(this),n=t.length>>>0;if(n===0)return-1;var r=0;arguments.length>0&&(r=Number(arguments[1]),r!=r?r=0:r!==0&&r!=Infinity&&r!=-Infinity&&(r=(r>0||-1)*Math.floor(Math.abs(r))));if(r>=n)return-1;var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++)if(i in t&&t[i]===e)return i;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){for(var n=0,r=this.length;n<r;++n)e.call(t,this[n],n,this)}),Array.prototype.some||(Array.prototype.some=function(e){if(this===null||this===undefined)throw new TypeError;var t=Object(this),n=t.length>>>0;if(typeof e!="function")throw new TypeError;var r=arguments[1];for(var i=0;i<n;i++)if(i in t&&e.call(r,t[i],i,t))return!0;return!1});var e=Object.prototype.toString,t=Array.toString();Array.isArray=Array.isArray||function(n){return typeof n=="object"&&(e.call(n)=="[object Array]"||"constructor"in n&&String(n.constructor)==t)},window.tomtom.setImagePath=function(e){e.lastIndexOf("/")!=e.length-1&&(e+="/"),tomtom.baseImagePath=e},tomtom.setImagePath("./images/"),window.tomtom.API_BASE_URL="https://api.tomtom.com/",window.tomtom.SERVICE_BASE_URL="lbs/",window.tomtom.releaseInfo={version:"2.1.0"},window.tomtom.isDebugMode=!1,window.tomtom.logApiCall=function(){},window.tomtom.languages={en_US:{units:{distance:{meter:"m;; m",km:"km;; km",yard:"yd;; yds",mile:"mi;; mi"},time:{day:"day;; days",hour:"hour;; hours",minute:"min;; mins",type:"12"}},errors:{Unknown:"Sorry, an error occurred. Please try again or come back later"},IncidentItem:{from:"From",to:"To",delay:"Delay",length:"Length"},IncidentBalloon:{Cluster:{title:"Incidents in this area: ",listHeader:"{count} most severe incidents",orderedByLength:"(Ordered by length)",orderedByDelay:"(Ordered by delay)"},zoomIn:"Click to zoom in"}}}}),define("tomtom/Utils",["./Main"],function(){tomtom.Utils={hostIndex:0,hosts:[],getServiceUrl:function(e,t,n,r,i){typeof i=="undefined"&&(i=tomtom.API_BASE_URL+tomtom.SERVICE_BASE_URL);if(t){var s=0;e.indexOf("?")==-1&&(e+="?");for(var o in t)s>0&&(e+="&"),e+=o+"="+t[o],s++}return tomtom.proxyUrl&&(i=tomtom.proxyUrl),typeof r!="undefined"&&(r?i=i.replace(/https?:\/\//g,"https://"):i=i.replace(/https?:\/\//g,"http://")),n&&(i="http://"+this.getRandomHost(i)),e.indexOf("https://")===0||e.indexOf("http://")===0?e:i+e},getRandomHost:function(e){e=e.replace(/https?:\/\//g,"");if(typeof tomtom.enableHostCycling=="undefined"||tomtom.enableHostCycling)this.hosts.length===0&&this.initHosts(),e=this.hosts[this.hostIndex],this.hostIndex++,this.hostIndex>3&&(this.hostIndex=0);return e},isArray:function(e){return Array.isArray(e)},zeroPad:function(e,t){e=String(e);var n=[];for(var r=0;r<t;++r)n.push("0");return n.join("").substring(0,t-e.length)+e},setCookie:function(e,t,n){var r="";if(n){var i=new Date;i.setTime(i.getTime()+n*24*60*60*1e3),r="; expires="+i.toGMTString()}document.cookie=e+"="+t+r+"; path=/"},getCookie:function(e){var t=e+"=",n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)==" ")i=i.substring(1,i.length);if(i.indexOf(t)===0)return i.substring(t.length,i.length)}return null},removeCookie:function(e){this.setCookie(e,"",-1)},formatSeconds:function(e){if(e===0)return{value:0,suffix:"minute"};if(e<=3600)return{value:this.round(e/60,1),suffix:"minute"};if(e>=3600)return{value:this.round(e/3600,1),suffix:"hour"}},metersToMiles:function(t){return t*e/5280},round:function(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)},getUniqueControlId:function(e){var n=e+"_"+t;return t++,n}};var e=3.28084,t=0;return tomtom.Utils}),define("tomtom/BaseObject",["./Main","./Utils"],function(){return tomtom.BaseObject=L.Class.extend({initialize:function(){},hitch:function(e){return L.Util.bind(e,this)}}),tomtom.BaseObject}),function(e,t){function tt(e,t,n,r){n=n||[],t=t||m;var i,s,a,f,l=t.nodeType;if(!e||typeof e!="string")return n;if(l!==1&&l!==9)return[];a=o(t);if(!a&&!r)if(i=q.exec(e))if(f=i[1]){if(l===9){s=t.getElementById(f);if(!s||!s.parentNode)return n;if(s.id===f)return n.push(s),n}else if(t.ownerDocument&&(s=t.ownerDocument.getElementById(f))&&u(t,s)&&s.id===f)return n.push(s),n}else{if(i[2])return E.apply(n,S.call(t.getElementsByTagName(e),0)),n;if((f=i[3])&&Y&&t.getElementsByClassName)return E.apply(n,S.call(t.getElementsByClassName(f),0)),n}return dt(e.replace(B,"$1"),t,n,r,a)}function nt(e){return function(t){var n=t.nodeName.toLowerCase();return n==="input"&&t.type===e}}function rt(e){return function(t){var n=t.nodeName.toLowerCase();return(n==="input"||n==="button")&&t.type===e}}function it(e){return T(function(t){return t=+t,T(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function st(e,t,n){if(e===t)return n;var r=e.nextSibling;while(r){if(r===t)return-1;r=r.nextSibling}return 1}function ot(e,t){var n,r,s,o,u,a,f,l=k[d][e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=i.preFilter;while(u){if(!n||(r=j.exec(u)))r&&(u=u.slice(r[0].length)||u),a.push(s=[]);n=!1;if(r=F.exec(u))s.push(n=new v(r.shift())),u=u.slice(n.length),n.type=r[0].replace(B," ");for(o in i.filter)(r=$[o].exec(u))&&(!f[o]||(r=f[o](r)))&&(s.push(n=new v(r.shift())),u=u.slice(n.length),n.type=o,n.matches=r);if(!n)break}return t?u.length:u?tt.error(e):k(e,a).slice(0)}function ut(e,t,r){var i=t.dir,s=r&&t.dir==="parentNode",o=b++;return t.first?function(t,n,r){while(t=t[i])if(s||t.nodeType===1)return e(t,n,r)}:function(t,r,u){if(!u){var a,f=y+" "+o+" ",l=f+n;while(t=t[i])if(s||t.nodeType===1){if((a=t[d])===l)return t.sizset;if(typeof a=="string"&&a.indexOf(f)===0){if(t.sizset)return t}else{t[d]=l;if(e(t,r,u))return t.sizset=!0,t;t.sizset=!1}}}else while(t=t[i])if(s||t.nodeType===1)if(e(t,r,u))return t}}function at(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function ft(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=t!=null;for(;u<a;u++)if(s=e[u])if(!n||n(s,r,i))o.push(s),f&&t.push(u);return o}function lt(e,t,n,r,i,s){return r&&!r[d]&&(r=lt(r)),i&&!i[d]&&(i=lt(i,s)),T(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||pt(t||"*",u.nodeType?[u]:u,[]),m=e&&(s||!t)?ft(v,h,e,u,a):v,g=n?i||(s?e:d||r)?[]:o:m;n&&n(m,g,u,a);if(r){f=ft(g,p),r(f,[],u,a),l=f.length;while(l--)if(c=f[l])g[p[l]]=!(m[p[l]]=c)}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?x.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=ft(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):E.apply(o,g)})}function ct(e){var t,n,r,s=e.length,o=i.relative[e[0].type],u=o||i.relative[" "],a=o?1:0,f=ut(function(e){return e===t},u,!0),l=ut(function(e){return x.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==c)||((t=n).nodeType?f(e,n,r):l(e,n,r))}];for(;a<s;a++)if(n=i.relative[e[a].type])h=[ut(at(h),n)];else{n=i.filter[e[a].type].apply(null,e[a].matches);if(n[d]){r=++a;for(;r<s;r++)if(i.relative[e[r].type])break;return lt(a>1&&at(h),a>1&&e.slice(0,a-1).join("").replace(B,"$1"),n,a<r&&ct(e.slice(a,r)),r<s&&ct(e=e.slice(r)),r<s&&e.join(""))}h.push(n)}return at(h)}function ht(e,t){var r=t.length>0,s=e.length>0,o=function(u,a,f,l,h){var p,d,v,g=[],b=0,S="0",x=u&&[],T=h!=null,N=c,C=u||s&&i.find.TAG("*",h&&a.parentNode||a),k=y+=N==null?1:Math.E;T&&(c=a!==m&&a,n=o.el);for(;(p=C[S])!=null;S++){if(s&&p){for(d=0;v=e[d];d++)if(v(p,a,f)){l.push(p);break}T&&(y=k,n=++o.el)}r&&((p=!v&&p)&&b--,u&&x.push(p))}b+=S;if(r&&S!==b){for(d=0;v=t[d];d++)v(x,g,a,f);if(u){if(b>0)while(S--)!x[S]&&!g[S]&&(g[S]=w.call(l));g=ft(g)}E.apply(l,g),T&&!u&&g.length>0&&b+t.length>1&&tt.uniqueSort(l)}return T&&(y=k,c=N),x};return o.el=0,r?T(o):o}function pt(e,t,n){var r=0,i=t.length;for(;r<i;r++)tt(e,t[r],n);return n}function dt(e,t,n,r,s){var o,u,f,l,c,h=ot(e),p=h.length;if(!r&&h.length===1){u=h[0]=h[0].slice(0);if(u.length>2&&(f=u[0]).type==="ID"&&t.nodeType===9&&!s&&i.relative[u[1].type]){t=i.find.ID(f.matches[0].replace(V,""),t,s)[0];if(!t)return n;e=e.slice(u.shift().length)}for(o=$.POS.test(e)?-1:u.length-1;o>=0;o--){f=u[o];if(i.relative[l=f.type])break;if(c=i.find[l])if(r=c(f.matches[0].replace(V,""),U.test(u[0].type)&&t.parentNode||t,s)){u.splice(o,1),e=r.length&&u.join("");if(!e)return E.apply(n,S.call(r,0)),n;break}}}return a(e,h)(r,t,s,n,U.test(e)),n}function vt(){}var n,r,i,s,o,u,a,f,l,c,h=!0,p="undefined",d=("sizcache"+Math.random()).replace(".",""),v=String,m=e.document,g=m.documentElement,y=0,b=0,w=[].pop,E=[].push,S=[].slice,x=[].indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(this[t]===e)return t;return-1},T=function(e,t){return e[d]=t==null||t,e},N=function(){var e={},t=[];return T(function(n,r){return t.push(n)>i.cacheLength&&delete e[t.shift()],e[n+" "]=r},e)},C=N(),k=N(),L=N(),A="[\\x20\\t\\r\\n\\f]",O="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",M=O.replace("w","w#"),_="([*^$|!~]?=)",D="\\["+A+"*("+O+")"+A+"*(?:"+_+A+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+M+")|)|)"+A+"*\\]",P=":("+O+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+D+")|[^:]|\\\\.)*|.*))\\)|)",H=":(even|odd|eq|gt|lt|nth|first|last)(?:\\("+A+"*((?:-\\d)?\\d*)"+A+"*\\)|)(?=[^-]|$)",B=new RegExp("^"+A+"+|((?:^|[^\\\\])(?:\\\\.)*)"+A+"+$","g"),j=new RegExp("^"+A+"*,"+A+"*"),F=new RegExp("^"+A+"*([\\x20\\t\\r\\n\\f>+~])"+A+"*"),I=new RegExp(P),q=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,R=/^:not/,U=/[\x20\t\r\n\f]*[+~]/,z=/:not\($/,W=/h\d/i,X=/input|select|textarea|button/i,V=/\\(?!\\)/g,$={ID:new RegExp("^#("+O+")"),CLASS:new RegExp("^\\.("+O+")"),NAME:new RegExp("^\\[name=['\"]?("+O+")['\"]?\\]"),TAG:new RegExp("^("+O.replace("w","w*")+")"),ATTR:new RegExp("^"+D),PSEUDO:new RegExp("^"+P),POS:new RegExp(H,"i"),CHILD:new RegExp("^:(only|nth|first|last)-child(?:\\("+A+"*(even|odd|(([+-]|)(\\d*)n|)"+A+"*(?:([+-]|)"+A+"*(\\d+)|))"+A+"*\\)|)","i"),needsContext:new RegExp("^"+A+"*[>+~]|"+H,"i")},J=function(e){var t=m.createElement("div");try{return e(t)}catch(n){return!1}finally{t=null}},K=J(function(e){return e.appendChild(m.createComment("")),!e.getElementsByTagName("*").length}),Q=J(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==p&&e.firstChild.getAttribute("href")==="#"}),G=J(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return t!=="boolean"&&t!=="string"}),Y=J(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!e.getElementsByClassName||!e.getElementsByClassName("e").length?!1:(e.lastChild.className="e",e.getElementsByClassName("e").length===2)}),Z=J(function(e){e.id=d+0,e.innerHTML="<a name='"+d+"'></a><div name='"+d+"'></div>",g.insertBefore(e,g.firstChild);var t=m.getElementsByName&&m.getElementsByName(d).length===2+m.getElementsByName(d+0).length;return r=!m.getElementById(d),g.removeChild(e),t});try{S.call(g.childNodes,0)[0].nodeType}catch(et){S=function(e){var t,n=[];for(;t=this[e];e++)n.push(t);return n}}tt.matches=function(e,t){return tt(e,null,null,t)},tt.matchesSelector=function(e,t){return tt(t,null,null,[e]).length>0},s=tt.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(i===1||i===9||i===11){if(typeof e.textContent=="string")return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=s(e)}else if(i===3||i===4)return e.nodeValue}else for(;t=e[r];r++)n+=s(t);return n},o=tt.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!=="HTML":!1},u=tt.contains=g.contains?function(e,t){var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!(r&&r.nodeType===1&&n.contains&&n.contains(r))}:g.compareDocumentPosition?function(e,t){return t&&!!(e.compareDocumentPosition(t)&16)}:function(e,t){while(t=t.parentNode)if(t===e)return!0;return!1},tt.attr=function(e,t){var n,r=o(e);return r||(t=t.toLowerCase()),(n=i.attrHandle[t])?n(e):r||G?e.getAttribute(t):(n=e.getAttributeNode(t),n?typeof e[t]=="boolean"?e[t]?t:null:n.specified?n.value:null:null)},i=tt.selectors={cacheLength:50,createPseudo:T,match:$,attrHandle:Q?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},find:{ID:r?function(e,t,n){if(typeof t.getElementById!==p&&!n){var r=t.getElementById(e);return r&&r.parentNode?[r]:[]}}:function(e,n,r){if(typeof n.getElementById!==p&&!r){var i=n.getElementById(e);return i?i.id===e||typeof i.getAttributeNode!==p&&i.getAttributeNode("id").value===e?[i]:t:[]}},TAG:K?function(e,t){if(typeof t.getElementsByTagName!==p)return t.getElementsByTagName(e)}:function(e,t){var n=t.getElementsByTagName(e);if(e==="*"){var r,i=[],s=0;for(;r=n[s];s++)r.nodeType===1&&i.push(r);return i}return n},NAME:Z&&function(e,t){if(typeof t.getElementsByName!==p)return t.getElementsByName(name)},CLASS:Y&&function(e,t,n){if(typeof t.getElementsByClassName!==p&&!n)return t.getElementsByClassName(e)}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(V,""),e[3]=(e[4]||e[5]||"").replace(V,""),e[2]==="~="&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),e[1]==="nth"?(e[2]||tt.error(e[0]),e[3]=+(e[3]?e[4]+(e[5]||1):2*(e[2]==="even"||e[2]==="odd")),e[4]=+(e[6]+e[7]||e[2]==="odd")):e[2]&&tt.error(e[0]),e},PSEUDO:function(e){var t,n;if($.CHILD.test(e[0]))return null;if(e[3])e[2]=e[3];else if(t=e[4])I.test(t)&&(n=ot(t,!0))&&(n=t.indexOf(")",t.length-n)-t.length)&&(t=t.slice(0,n),e[0]=e[0].slice(0,n)),e[2]=t;return e.slice(0,3)}},filter:{ID:r?function(e){return e=e.replace(V,""),function(t){return t.getAttribute("id")===e}}:function(e){return e=e.replace(V,""),function(t){var n=typeof t.getAttributeNode!==p&&t.getAttributeNode("id");return n&&n.value===e}},TAG:function(e){return e==="*"?function(){return!0}:(e=e.replace(V,"").toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=C[d][e+" "];return t||(t=new RegExp("(^|"+A+")"+e+"("+A+"|$)"))&&C(e,function(e){return t.test(e.className||typeof e.getAttribute!==p&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r,i){var s=tt.attr(r,e);return s==null?t==="!=":t?(s+="",t==="="?s===n:t==="!="?s!==n:t==="^="?n&&s.indexOf(n)===0:t==="*="?n&&s.indexOf(n)>-1:t==="$="?n&&s.substr(s.length-n.length)===n:t==="~="?(" "+s+" ").indexOf(n)>-1:t==="|="?s===n||s.substr(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r){return e==="nth"?function(e){var t,i,s=e.parentNode;if(n===1&&r===0)return!0;if(s){i=0;for(t=s.firstChild;t;t=t.nextSibling)if(t.nodeType===1){i++;if(e===t)break}}return i-=r,i===n||i%n===0&&i/n>=0}:function(t){var n=t;switch(e){case"only":case"first":while(n=n.previousSibling)if(n.nodeType===1)return!1;if(e==="first")return!0;n=t;case"last":while(n=n.nextSibling)if(n.nodeType===1)return!1;return!0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||tt.error("unsupported pseudo: "+e);return r[d]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?T(function(e,n){var i,s=r(e,t),o=s.length;while(o--)i=x.call(e,s[o]),e[i]=!(n[i]=s[o])}):function(e){return r(e,0,n)}):r}},pseudos:{not:T(function(e){var t=[],n=[],r=a(e.replace(B,"$1"));return r[d]?T(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)if(s=o[u])e[u]=!(t[u]=s)}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:T(function(e){return function(t){return tt(e,t).length>0}}),contains:T(function(e){return function(t){return(t.textContent||t.innerText||s(t)).indexOf(e)>-1}}),enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&!!e.checked||t==="option"&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},parent:function(e){return!i.pseudos.empty(e)},empty:function(e){var t;e=e.firstChild;while(e){if(e.nodeName>"@"||(t=e.nodeType)===3||t===4)return!1;e=e.nextSibling}return!0},header:function(e){return W.test(e.nodeName)},text:function(e){var t,n;return e.nodeName.toLowerCase()==="input"&&(t=e.type)==="text"&&((n=e.getAttribute("type"))==null||n.toLowerCase()===t)},radio:nt("radio"),checkbox:nt("checkbox"),file:nt("file"),password:nt("password"),image:nt("image"),submit:rt("submit"),reset:rt("reset"),button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type==="button"||t==="button"},input:function(e){return X.test(e.nodeName)},focus:function(e){var t=e.ownerDocument;return e===t.activeElement&&(!t.hasFocus||t.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},active:function(e){return e===e.ownerDocument.activeElement},first:it(function(){return[0]}),last:it(function(e,t){return[t-1]}),eq:it(function(e,t,n){return[n<0?n+t:n]}),even:it(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:it(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:it(function(e,t,n){for(var r=n<0?n+t:n;--r>=0;)e.push(r);return e}),gt:it(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}},f=g.compareDocumentPosition?function(e,t){return e===t?(l=!0,0):(!e.compareDocumentPosition||!t.compareDocumentPosition?e.compareDocumentPosition:e.compareDocumentPosition(t)&4)?-1:1}:function(e,t){if(e===t)return l=!0,0;if(e.sourceIndex&&t.sourceIndex)return e.sourceIndex-t.sourceIndex;var n,r,i=[],s=[],o=e.parentNode,u=t.parentNode,a=o;if(o===u)return st(e,t);if(!o)return-1;if(!u)return 1;while(a)i.unshift(a),a=a.parentNode;a=u;while(a)s.unshift(a),a=a.parentNode;n=i.length,r=s.length;for(var f=0;f<n&&f<r;f++)if(i[f]!==s[f])return st(i[f],s[f]);return f===n?st(e,s[f],-1):st(i[f],t,1)},[0,0].sort(f),h=!l,tt.uniqueSort=function(e){var t,n=[],r=1,i=0;l=h,e.sort(f);if(l){for(;t=e[r];r++)t===e[r-1]&&(i=n.push(r));while(i--)e.splice(n[i],1)}return e},tt.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},a=tt.compile=function(e,t){var n,r=[],i=[],s=L[d][e+" "];if(!s){t||(t=ot(e)),n=t.length;while(n--)s=ct(t[n]),s[d]?r.push(s):i.push(s);s=L(e,ht(i,r))}return s},m.querySelectorAll&&function(){var e,t=dt,n=/'|\\/g,r=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,i=[":focus"],s=[":active"],u=g.matchesSelector||g.mozMatchesSelector||g.webkitMatchesSelector||g.oMatchesSelector||g.msMatchesSelector;J(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||i.push("\\["+A+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||i.push(":checked")}),J(function(e){e.innerHTML="<p test=''></p>",e.querySelectorAll("[test^='']").length&&i.push("[*^$]="+A+"*(?:\"\"|'')"),e.innerHTML="<input type='hidden'/>",e.querySelectorAll(":enabled").length||i.push(":enabled",":disabled")}),i=new RegExp(i.join("|")),dt=function(e,r,s,o,u){if(!o&&!u&&!i.test(e)){var a,f,l=!0,c=d,h=r,p=r.nodeType===9&&e;if(r.nodeType===1&&r.nodeName.toLowerCase()!=="object"){a=ot(e),(l=r.getAttribute("id"))?c=l.replace(n,"\\$&"):r.setAttribute("id",c),c="[id='"+c+"'] ",f=a.length;while(f--)a[f]=c+a[f].join("");h=U.test(e)&&r.parentNode||r,p=a.join(",")}if(p)try{return E.apply(s,S.call(h.querySelectorAll(p),0)),s}catch(v){}finally{l||r.removeAttribute("id")}}return t(e,r,s,o,u)},u&&(J(function(t){e=u.call(t,"div");try{u.call(t,"[test!='']:sizzle"),s.push("!=",P)}catch(n){}}),s=new RegExp(s.join("|")),tt.matchesSelector=function(t,n){n=n.replace(r,"='$1']");if(!o(t)&&!s.test(n)&&!i.test(n))try{var a=u.call(t,n);if(a||e||t.document&&t.document.nodeType!==11)return a}catch(f){}return tt(n,null,null,[t]).length>0})}(),i.pseudos.nth=i.pseudos.eq,i.filters=vt.prototype=i.pseudos,i.setFilters=new vt,typeof define=="function"&&define.amd?define("sizzle",[],function(){return tt}):e.Sizzle=tt}(window),define("tomtom/dom/DomUtilResult",["../BaseObject","../Utils"],function(e){return tomtom.dom.DomUtilResult=e.extend({initialize:function(e,t){this.elements=e,this.du=t},html:function(e){if(e===null||e===undefined){var t=this.first();return t?t.innerHTML:null}return this.du.html(this.elements,e),this},css:function(e,t){if(t===null||t===undefined){var n=this.first();return n?this.du.css(n,e):null}this.each(this.hitch(function(n){this.du.css(n,e,t)}))},append:function(e){if(typeof e=="string")this.each(function(t){t.innerHTML+=e});else{var t=this.first();t&&this.du.each(e,function(e){t.appendChild(e)})}return this},first:function(){return this.get(0)},get:function(e){if(e===null||e===undefined)e=0;return this.elements.length>e?this.elements[e]:null},each:function(e,t){return this.du.each(this.elements,e,t),this},val:function(e){if(e===undefined||e===null){var t=this.first();return t&&t.value?t.value:""}return this.du.val(this.elements,e),this},find:function(e){return this.du.query(e,this.elements)},on:function(e,t,n){return this.du.on(this.elements,e,t,n)},off:function(e,t){return this.du.off(this.elements,e,t)},attr:function(e,t){return this.du.attr(this.elements,e,t)},data:function(e,t){return this.du.data(this.elements,e,t)},removeAttr:function(e){return this.du.removeAttr(this.elements,e),this},next:function(e){return this.du.next(this.first(),e)},prev:function(e){return this.du.prev(this.first(),e)},children:function(e){return this.du.children(this.elements,e)},length:function(){return this.elements.length},addClass:function(e){return this.du.addClass(this.elements,e),this},removeClass:function(e){return this.du.removeClass(this.elements,e),this},offset:function(){return this.du.offset(this.first())},position:function(){return this.du.position(this.first())},offsetHeight:function(){var e=this.first();return e?e.offsetHeight:null},offsetWidth:function(){var e=this.first();return e?e.offsetWidth:null},height:function(){var e=this.first();return e?e.clientHeight:null},width:function(){var e=this.first();return e?e.clientWidth:null},empty:function(){return this.each(function(e){this.du.empty(e)},this),this},hide:function(){return this.each(function(){this.css("display","none")},this),this},show:function(){return this.each(function(){this.css("display","block")},this),this},parents:function(){return this.du.parents(this)},hasClass:function(e){return this.du.hasClass(this,e)}}),tomtom.dom.DomUtilResult}),define("tomtom/dom/DomUtil",["../BaseObject","sizzle","./DomUtilResult","../Utils"],function(e,t,n,r){return e=L.Util.extend({},L.DomUtil),tomtom.dom.DomUtil=L.Util.extend(e,{initialize:function(){},query:function(e,i){if(r.isArray(i)){var s=[];return i.forEach(function(n){t(e,n,s)}),new n(s,this)}return new n(t(e,i),this)},css:function(e,t,n){if(!e.style)return;if(typeof n=="undefined")return e.style[t];e.style[t]=n},offset:function(e){var t=0,n=0;do t+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);return{top:n,left:t}},empty:function(e){while(e.children.length>0)e.removeChild(e.children[0]);return new n(e,this)},html:function(e,t){return this.each(e,function(e){typeof t=="string"||typeof t=="number"?e.innerHTML=t:(this.empty(e),e.appendChild(t))}),new n(e,this)},append:function(e,t){return this.each(e,function(e){typeof t=="string"?e.innerHTML+=t:e.appendChild(t)}),new n(e,this)},attr:function(e,t,r){return typeof r=="undefined"?this.first(e).getAttribute(t):(this.each(e,function(e){e.setAttribute(t,r)}),new n(e,this))},removeAttr:function(e,t){return this.each(e,function(e){e.removeAttribute(t)}),new n(e,this)},data:function(e,t,r){if(typeof r!="undefined")return this.each(e,function(e){e._ttData||(e._ttData={}),e._ttData[t]=r}),new n(e,this);var i=this.first(e);return i?i._ttData[t]:null},val:function(e,t){if(typeof t=="undefined"){var r=this.first(e);return r?r.value:""}return this.each(e,function(e){e.value=t}),new n(e,this)},_nlToArray:function(e){var t=[];for(var n=e.length;n--;t.unshift(e[n]));return t},next:function(e,r){var i=this.first(e),s=i.parentNode,o=this._nlToArray(s.childNodes),u=o.indexOf(i);return u==-1?null:u<o.length?(e=o.splice(u+1,o.length-u),r?new n(t.matches(r,e),this):new n(e,this)):new n([],this)},prev:function(e,r){var i=this.first(e),s=i.parentNode,o=this._nlToArray(s.childNodes),u=o.indexOf(i);return u>0?(e=o.splice(0,u),e.reverse(),r?new n(t.matches(r,e),this):new n(e,this)):new n([],this)},children:function(e,r){return r?new n(t.matches(r,this.first(e).childNodes),this):new n(this.first(e).childNodes,this)},viewport:function(){return{width:window.innerWidth,height:window.innerHeight}},removeClass:function(e,t){return this.each(e,function(e){L.DomUtil.removeClass(e,t)}),new n(e,this)},addClass:function(e,t){return this.each(e,function(e){L.DomUtil.addClass(e,t)}),new n(e,this)},isNodeList:function(e){return typeof e.length=="number"&&typeof e.item!="undefined"},dimensions:function(e){return{width:e.clientWidth,height:e.clientHeight,outerWidth:e.offsetWidth,outerHeight:e.offsetHeight}},on:function(e,t,r,i){return this.each(e,function(e){L.DomEvent.on(e,t,r,i)}),new n(e,this)},off:function(e,t,r){return this.each(e,function(e){L.DomEvent.off(e,t,r)}),new n(e,this)},create:function(e,t){var r=e;return t||(t=""),typeof e=="string"&&(r=L.DomUtil.create.apply(this,[e,t])),new n([r],this)},each:function(e,t,n){e.du&&e.elements&&(e=e.elements);if(!r.isArray(e)&&!this.isNodeList(e))return t.apply(n,[e,0]),this;for(var i=0;i<e.length;i++){var s=t.apply(n?n:this,[e[i],i]);if(s===!1)break}},first:function(e){return!r.isArray(e)&&!this.isNodeList(e)?e:e[0]},parents:function(e){var t=[];return this.each(e,function(e){var n=e.parentNode;while(n!==null&&n!==undefined)t.push(n),n=n.parentNode},this),new n(t,this)},hasClass:function(e,t){var n=!1;return this.each(e,function(e){if(e.className&&L.DomUtil.hasClass(e,t))return n=!0,!1},this),n}}),tomtom.dom.DomUtil}),define("tomtom/Logger",["./Main"],function(){return tomtom.Logger=L.Class.extend({initialize:function(){},info:function(){this._log("info",arguments)},debug:function(){this._log("debug",arguments)},log:function(){this._log("log",arguments)},error:function(){this._log("error",arguments)},warn:function(){this._log("warn",arguments)},_log:function(e,t){if(!tomtom.isDebugMode&&(e=="log"||e=="debug"))return;if(typeof console!="undefined"){var n=console[e];n?n.apply?n.apply(console,t):n(t[0]):n!="log"&&this._log("log",t)}}}),tomtom.Logger}),define("tomtom/services/BaseService",["../BaseObject","../Logger"],function(e,t){return tomtom.services.BaseService=e.extend({initialize:function(n){this.log=new t,e.prototype.initialize.apply(this,[]),n?this.apiKey=n:this.apiKey=tomtom.apiKey,!this.apiKey&&!tomtom.proxyUrl&&this.log.warn('An API Key has not been specified.  TomTom services will not work without an API Key. Please specify an API key either via tomtom.apiKey OR by passing the apiKey to the service\'s constructor: var service = new tomtom.services.GeocodeService("your key here");')}}),tomtom.services.BaseService.BASE_URL="lbs/services/",tomtom.services.BaseService}),define("tomtom/AjaxUtil",["./Main"],function(){tomtom.AjaxUtil={getJSON:function(e){var t;window.XMLHttpRequest?t=new XMLHttpRequest:t=new ActiveXObject("Microsoft.XMLHTTP"),t.onreadystatechange=function(){t.readyState==4&&t.status==200&&e.callback(JSON.parse(t.responseText))},t.open("GET",e.url,!0),t.send()},getJSONP:function(t){e.get(t.url,t.data,t.callback,t.callbackParam)}};var e=function(){function s(e){var n=document.createElement("script"),r=!1;n.src=e,n.async=!0,n.onload=n.onreadystatechange=function(){!r&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")&&(r=!0,n.onload=n.onreadystatechange=null,n&&n.parentNode&&n.parentNode.removeChild(n))},t||(t=document.getElementsByTagName("head")[0]),t.appendChild(n)}function o(e){return encodeURIComponent(e)}function u(t,u,a,f){n=(t||"").indexOf("?")===-1?"?":"&",u=u||{};for(var l in u)u.hasOwnProperty(l)&&(n+=o(l)+"="+o(u[l])+"&");var c="json"+ ++e;return r[c]=function(e){a(e);try{delete r[c]}catch(t){}r[c]=null},s(t+n+(f||i.callbackName||"callback")+"="+c),c}function a(e){i=e}var e=0,t,n,r=this,i={};return{get:u,init:a}}();return tomtom.AjaxUtil}),define("tomtom/services/InitializeService",["./BaseService","../Utils","../AjaxUtil"],function(e,t,n){tomtom.services.InitializeService=e.extend({initialize:function(t){e.prototype.initialize.apply(this,arguments)},getCopyrightInfo:function(e,i){typeof e=="function"&&(i=e,e={}),this.apiKey&&(e.key=this.apiKey);var s=tomtom.services.InitializeService.URL||r;tomtom.logApiCall("initialize"),tomtom.proxyUrl?n.getJSON({url:t.getServiceUrl(s,e),callback:i}):n.getJSONP({url:t.getServiceUrl(s+"p",e),callback:i,callbackParam:"jsonp"})}});var r="services/initialize/3/json";return tomtom.services.InitializeService}),define("tomtom/services/ViewportService",["./BaseService","../AjaxUtil","../Utils"],function(e,t,n){tomtom.services.ViewportService=e.extend({initialize:function(){e.prototype.initialize.apply(this,arguments)},getViewportModel:function(e,s,o,u,a,f){typeof a=="function"&&(f=a,a={}),a.projection||(a.projection="EPSG4326");var l=new L.LatLng(e.top,e.right,!0),c=new L.LatLng(e.bottom,e.left,!0),h=new L.LatLng(o.top,o.right,!0),p=new L.LatLng(o.bottom,o.left,!0);if(a.projection=="EPSG4326"){var d=L.CRS.EPSG3857;l=d.project(l),c=d.project(c),h=d.project(h),p=d.project(p)}else l=new L.Point(l.lng,l.lat),c=new L.Point(c.lng,c.lat),h=new L.Point(h.lng,h.lat),p=new L.Point(p.lng,p.lat);var v=c.x,m=c.y,g=l.x,y=l.y;v=v<r.minX?r.minX:v,m=m<r.minY?r.minY:m,g=g>r.maxX?r.maxX:g,y=y>r.maxY?r.maxY:y;var b=p.x<r.minX?r.minX:p.x,w=p.y<r.minY?r.minY:p.y,E=h.x>r.maxX?r.maxX:h.x,S=h.y>r.maxY?r.maxY:h.y,x={box:m+","+v+","+y+","+g,zoom:s,overviewBox:w+","+b+","+S+","+E,overviewZoom:u,copyright:typeof a.copyright=="undefined"?!0:a.copyright};this.apiKey&&(a.key=this.apiKey);var T=tomtom.services.ViewportService.VIEWPORT_URL||i;tomtom.logApiCall("viewport"),tomtom.proxyUrl?t.getJSON({url:n.getServiceUrl(L.Util.template(T,x),a),callback:f}):t.getJSONP({url:n.getServiceUrl(L.Util.template(T+"p",x),a),callback:f,callbackParam:"jsonp"})}});var r={minX:-40075016.6855784,minY:-40075016.6855784,maxX:40075016.6855784,maxY:40075016.6855784},i="services/viewportDesc/3/{box}/{zoom}/{overviewBox}/{overviewZoom}/{copyright}/json";return tomtom.services.ViewportService}),define("tomtom/services/RoutingResponse",["../BaseObject"],function(e){return e.extend({initialize:function(t){e.prototype.initialize.apply(this,arguments),this._data=t,this._processPoints();var n=t.summary.bbox;this.bounds=new L.LatLngBounds(L.latLng(n.bottomLeft.latitude,n.bottomLeft.longitude),L.latLng(n.topRight.latitude,n.topRight.longitude)),this._data.instructions&&(this.instructions=this._data.instructions.instruction),this.summary=this._data.summary},_processPoints:function(){var e=this._data;if(e){if(e.pathPoints){var t=e.pathPoints.latitude,n=e.pathPoints.longitude,r=[];if(t.length>0){var i=t[0],s=n[0];for(var o=0;o<t.length;o++)o>0&&(i+=t[o],s+=n[o]),r.push(new L.LatLng(i,s));this.vectorPoints=r}}}else console.error("An invalid route response was returned.")}})}),define("tomtom/services/RoutingService",["./BaseService","./RoutingResponse","../AjaxUtil","../Utils"],function(e,t,n,r){tomtom.services.RoutingService=e.extend({initialize:function(t){e.prototype.initialize.apply(this,arguments)},getRoute:function(e,o,u){typeof o=="function"&&(u=o,o={}),this.apiKey&&(o.key=this.apiKey);var a=L.Util.extend({},o);a.routeType&&delete a.routeType,a.includeVectorData&&(delete a.includeVectorData,a.pathPoints=17),o.routeType||(o.routeType=s),a.language||(a.language=tomtom.LocaleManager.getPrimaryLanguage());var f=[];for(var l=0;l<e.length;l++){var c=L.latLng(e[l]);f.push(c.lat+","+c.lng)}var h={points:f.join(":"),routeType:o.routeType},p=tomtom.services.RoutingService.URL||i;tomtom.logApiCall("route"),tomtom.proxyUrl?n.getJSON({url:r.getServiceUrl(L.Util.template(p,h),a),callback:function(e){u(new t(e.route))}}):n.getJSONP({url:r.getServiceUrl(L.Util.template(p+"p",h),a),callback:function(e){u(new t(e.route))},callbackParam:"jsonp"})}});var i="services/route/3/{points}/{routeType}/json",s="Quickest";return tomtom.services.RoutingService}),define("tomtom/services/GeocodingService",["./BaseService","../Utils","../AjaxUtil"],function(e,t,n){tomtom.services.GeocodingService=e.extend({initialize:function(t){e.prototype.initialize.apply(this,arguments)},geocode:function(e,i,s){typeof i=="function"&&(s=i,i={});var o={format:tomtom.proxyUrl?"json":"jsonp"};typeof e=="string"?o.query=e:o=L.Util.extend(o,e),this.apiKey&&(o.key=this.apiKey),o=L.Util.extend(o,i);var u=tomtom.services.GeocodingService.GEOCODE_URL||r;tomtom.logApiCall("geocode"),tomtom.proxyUrl?n.getJSON({url:t.getServiceUrl(u,o),callback:s}):n.getJSONP({url:t.getServiceUrl(u,o),callback:s})},reverseGeocode:function(e,r,s,o){if(isNaN(r)){o=s,s=r;var u=L.latLng(e);e=u.lat,r=u.lng}typeof s=="function"&&(o=s,s={});var a={point:e+","+r,projection:"EPSG4326"};a=L.Util.extend(a,s),this.apiKey&&(a.key=this.apiKey);var f=tomtom.services.GeocodingService.REVERSE_GEOCODE_URL||i;tomtom.proxyUrl?n.getJSON({url:t.getServiceUrl(f,a),callback:o}):n.getJSONP({url:t.getServiceUrl(f+"p",a),callback:o,callbackParam:"jsonp"})}});var r="services/geocode/4/geocode",i="services/reverseGeocode/3/json";return tomtom.services.GeocodingService}),define("tomtom/layers/MapLayer",["../Main","../Utils"],function(e,t){return tomtom.layers.MapLayer=L.TileLayer.extend({initialize:function(e){typeof e=="undefined"&&(e={}),e.apiKey||(e.apiKey=tomtom.apiKey);var n=t.getServiceUrl("map/3/basic/1/{z}/{x}/{y}.png");if(typeof tomtom.enableHostCycling=="undefined"||tomtom.enableHostCycling)n=n.replace(/http(s)?:\/\//g,"http$1://{s}.");tomtom.proxyUrl||(n+="?key={apiKey}"),L.TileLayer.prototype.initialize.apply(this,[n,e])},_loadTile:function(){L.TileLayer.prototype._loadTile.apply(this,arguments),tomtom.logApiCall("mapTileBasic")}}),tomtom.layers.MapLayer}),define("tomtom/layers/TrafficLayer",["../Utils","../Main"],function(e){tomtom.layers.TrafficLayer=L.TileLayer.extend({initialize:function(n,r,i){var s=n,o=i||e.getServiceUrl(t,!1,!1);if(typeof tomtom.enableHostCycling=="undefined"||tomtom.enableHostCycling)o=o.replace(/https?:\/\//g,"http://{s}.");L.TileLayer.prototype.initialize.apply(this,[o,{apiKey:s,trafficModel:r||-1}])},update:function(e){this.options.trafficModel!=e&&(this.options.trafficModel=e,this.redraw())},setTrafficModel:function(e){this.options.trafficModel=e},_loadTile:function(){L.TileLayer.prototype._loadTile.apply(this,arguments),tomtom.logApiCall("mapTileTraffic")}});var t="map/3/traffic/s2/{z}/{x}/{y}.png?t={trafficModel}&key={apiKey}";return tomtom.layers.TrafficLayer}),define("tomtom/lib/leaflet-encoded-polyline",[],function(){var e=function(e){return typeof e=="number"?e={precision:e}:e=e||{},e.precision=e.precision||5,e.factor=e.factor||Math.pow(10,e.precision),e.dimension=e.dimension||2,e},t={encode:function(t,n){n=e(n);var r=[];for(var i=0,s=t.length;i<s;++i){var o=t[i];if(n.dimension===2)r.push(o.lat||o[0]),r.push(o.lng||o[1]);else for(var u=0;u<n.dimension;++u)r.push(o[u])}return this.encodeDeltas(r,n)},decode:function(t,n){n=e(n);var r=this.decodeDeltas(t,n),i=[];for(var s=0,o=r.length;s+(n.dimension-1)<o;){var u=[];for(var a=0;a<n.dimension;++a)u.push(r[s++]);i.push(u)}return i},encodeDeltas:function(t,n){n=e(n);var r=[];for(var i=0,s=t.length;i<s;)for(var o=0;o<n.dimension;++o,++i){var u=t[i],a=u-(r[o]||0);r[o]=u,t[i]=a}return this.encodeFloats(t,n)},decodeDeltas:function(t,n){n=e(n);var r=[],i=this.decodeFloats(t,n);for(var s=0,o=i.length;s<o;)for(var u=0;u<n.dimension;++u,++s)i[s]=r[u]=i[s]+(r[u]||0);return i},encodeFloats:function(t,n){n=e(n);for(var r=0,i=t.length;r<i;++r)t[r]=Math.round(t[r]*n.factor);return this.encodeSignedIntegers(t)},decodeFloats:function(t,n){n=e(n);var r=this.decodeSignedIntegers(t);for(var i=0,s=r.length;i<s;++i)r[i]/=n.factor;return r},encodeSignedIntegers:function(e){for(var t=0,n=e.length;t<n;++t){var r=e[t];e[t]=r<0?~(r<<1):r<<1}return this.encodeUnsignedIntegers(e)},decodeSignedIntegers:function(e){var t=this.decodeUnsignedIntegers(e);for(var n=0,r=t.length;n<r;++n){var i=t[n];t[n]=i&1?~(i>>1):i>>1}return t},encodeUnsignedIntegers:function(e){var t="";for(var n=0,r=e.length;n<r;++n)t+=this.encodeUnsignedInteger(e[n]);return t},decodeUnsignedIntegers:function(e){var t=[],n=0,r=0;for(var i=0,s=e.length;i<s;++i){var o=e.charCodeAt(i)-63;n|=(o&31)<<r,o<32?(t.push(n),n=0,r=0):r+=5}return t},encodeSignedInteger:function(e){return e=e<0?~(e<<1):e<<1,this.encodeUnsignedInteger(e)},encodeUnsignedInteger:function(e){var t,n="";while(e>=32)t=(32|e&31)+63,n+=String.fromCharCode(t),e>>=5;return t=e+63,n+=String.fromCharCode(t),n}};typeof module=="object"&&typeof module.exports=="object"&&(module.exports=t);if(typeof L=="object"){L.Polyline.prototype.fromEncoded||(L.Polyline.fromEncoded=function(e,n){return new L.Polyline(t.decode(e),n)}),L.Polygon.prototype.fromEncoded||(L.Polygon.fromEncoded=function(e,n){return new L.Polygon(t.decode(e),n)});var n={encodePath:function(){return t.encode(this.getLatLngs())}};L.Polyline.prototype.encodePath||L.Polyline.include(n),L.Polygon.prototype.encodePath||L.Polygon.include(n),L.PolylineUtil=t}return L.PolylineUtil}),define("tomtom/Animation",["./dom/DomUtil","./Utils","./Main"],function(e){function t(e){return e}function n(e){return Math.pow(e,2)}function r(e){for(var t=0,n=1;1;t+=n,n/=2)if(e>=(7-4*t)/11)return-Math.pow((11-6*t-11*e)/4,2)+Math.pow(n,2)}function i(e){return function(t){return 1-e(1-t)}}tomtom.Animation=L.Class.extend({initialize:function(e,t,n){this.element=L.DomUtil.get(e),this.effect=t,this.options=n,this.options||(this.options={}),this.options.duration||(this.options.duration=s),this._originalPosition=L.DomUtil.getPosition(e)},dropIn:function(){var t=this.element,n=L.DomUtil.getPosition(t),s=this.options.height;return s||(s=t.offsetHeight*10),L.DomUtil.setPosition(t,{x:n.x,y:n.y-s}),e.css(t,"display","none"),function(){e.css(t,"display","block"),this.animate({delta:i(r),step:function(e){L.DomUtil.setPosition(t,{x:n.x,y:n.y*e})}})}},bounce:function(){var t=this.element,s=L.DomUtil.getPosition(t),o=this.options.height;return this.options.duration=this.options.duration/2,o||(o=t.offsetHeight*5),e.css(t,"display","none"),function(){e.css(t,"display","block"),this.animate({delta:i(n),step:function(e){L.DomUtil.setPosition(t,{x:s.x,y:s.y-Math.abs(s.y-(s.y-o))*e})},callback:L.Util.bind(function(){if(this._cancel)return;L.DomUtil.setPosition(t,{x:s.x,y:s.y-o}),s=L.DomUtil.getPosition(t),this.animate({delta:i(r),step:L.Util.bind(function(e){if(this._cancel)return;L.DomUtil.setPosition(t,{x:s.x,y:s.y+Math.abs(s.y-(s.y+o))*e})},this)})},this)})}},fadeIn:function(){var e=this.element;return L.DomUtil.setOpacity(e,0),function(){this.animate({delta:i(t),step:L.Util.bind(function(t){if(this._cancel)return;L.DomUtil.setOpacity(e,t)},this)})}},fadeOut:function(){var e=this.element;return L.DomUtil.setOpacity(e,1),function(){this.animate({delta:i(t),step:L.Util.bind(function(t){if(this._cancel)return;L.DomUtil.setOpacity(e,1-t)},this)})}},play:function(){var e=this[this.effect];if(e&&typeof e=="function"){if(this.element.style.display=="none")return;this.animationTimeoutId&&clearTimeout(this.animationTimeoutId);var t=e.apply(this,[]);this.options.delay?this.animationTimeoutId=setTimeout(L.Util.bind(function(){t.apply(this,[])},this),this.options.delay):t.apply(this,[])}},stop:function(){this._cancel=!0,clearInterval(this._animationInterval),clearTimeout(this.animationTimeoutId),this.element.style.display="block",L.DomUtil.setPosition(this.element,this._originalPosition)},animate:function(e){var t=new Date,n=setInterval(L.Util.bind(function(){var r=new Date-t,i=r/this.options.duration;i>1&&(i=1);var s=e.delta(i);e.step(s),i==1&&(clearInterval(n),e.callback?e.callback():this.options.callback&&this.options.callback())},this),o);this._animationInterval=n}});var s=500,o=25;return tomtom.Animation}),define("tomtom/Marker",["./Main","./Animation","./dom/DomUtil"],function(e,t){return tomtom.Marker=L.Marker.extend({initialize:function(e,t,n){n||(n={});if(!n.icon){t?t=L.Util.extend({},t):t=L.Util.extend({},tomtom.Marker.DEFAULT_MARKER_OPTIONS);var r=t.iconUrl;r&&r.indexOf("http://")!==0&&r.indexOf("https://")!==0&&r.indexOf("/")!==0&&(t.iconUrl=tomtom.baseImagePath+t.iconUrl),n.icon=L.icon(t)}L.Marker.prototype.initialize.apply(this,[e,n])},onAdd:function(e){L.Marker.prototype.onAdd.apply(this,arguments),this.contextMenu&&(this.contextMenu.map||this.contextMenu.onAdd(e),this._icon&&this.contextMenu.addTarget(this._icon,this))},setContextMenu:function(e){this.contextMenu&&this.contextMenu.destroy(),this.contextMenu=e,this._icon&&e.addTarget(this._icon,this),this._map&&!e.map&&e.onAdd(this._map)},animate:function(e,n){if(!this._currentAnimation){var r=n.callback;n.callback=L.Util.bind(function(){this._currentAnimation=null,r&&r()},this);var i=new t(this._icon,e,n);i.play(),this._currentAnimation=i}},stopAnimation:function(){var e=this._currentAnimation;e&&e.stop(),this._currentAnimation=null},bindPopup:function(e,t){t&&t.showOnMouseOver?(L.Marker.prototype.bindPopup.apply(this,[e,t]),this.off("click",this.openPopup,this),this.on("mouseover",function(e){var t=e.originalEvent.fromElement||e.originalEvent.relatedTarget,n=this._getParent(t,"leaflet-popup");if(n==this._popup._container)return!0;this.openPopup()},this),this.on("mouseout",function(e){var t=e.originalEvent.toElement||e.originalEvent.relatedTarget;if(this._getParent(t,"leaflet-popup"))return L.DomEvent.on(this._popup._container,"mouseout",this._popupMouseOut,this),!0;this.closePopup()},this)):L.Marker.prototype.bindPopup.apply(this,arguments)},_popupMouseOut:function(e){L.DomEvent.off(this._popup,"mouseout",this._popupMouseOut,this);var t=e.toElement||e.relatedTarget;if(this._getParent(t,"leaflet-popup"))return!0;if(t==this._icon)return!0;this.closePopup()},_getParent:function(e,t){var n=e.parentNode;while(n!==null&&n!==undefined){if(n.className&&L.DomUtil.hasClass(n,t))return n;n=n.parentNode}return!1}}),tomtom.Marker.DEFAULT_MARKER_OPTIONS={iconUrl:"marker.png",iconSize:[51,60],iconAnchor:[21,49],popupAnchor:[0,-49]},tomtom.Marker}),define("tomtom/CustomDivIcon",[],function(){return tomtom.CustomDivIcon=L.DivIcon.extend({_setIconStyles:function(e,t){e.className="leaflet-marker-"+t+" "+this.options.className}}),tomtom.CustomDivIcon}),define("tomtom/CustomMarker",["./Main","./Marker","./dom/DomUtil","./CustomDivIcon"],function(e,t,n,r){return tomtom.CustomMarker=tomtom.Marker.extend({initialize:function(e,t,n){n||(n={}),n.icon=new r({className:t,html:n.html||"&nbsp;",iconSize:null}),tomtom.Marker.prototype.initialize.apply(this,[e,null,n])},setClassName:function(e){this._icon.className=e},setHTML:function(e){n.html(this._icon,e)}}),tomtom.CustomMarker}),define("tomtom/TrafficMarker",["./CustomMarker","sizzle"],function(e,t){tomtom.TrafficMarker=tomtom.CustomMarker.extend({initialize:function(e,t){this.incidentType=tomtom.TrafficMarker.getTypeString(t.ty),this.iconCategory=tomtom.TrafficMarker.getCategoryString(t.ic),this.clusterSize=t.cs,this._incident=t,this.clusterSize&&this.iconCategory!="region"&&(this.iconCategory="cluster"),tomtom.CustomMarker.prototype.initialize.apply(this,[e,"trafficIcon"])},onAdd:function(e){tomtom.CustomMarker.prototype.onAdd.apply(this,arguments),this.configureIcon(),this.off("mouseover",this._onMouseOver),this.off("mouseout",this._onMouseOut),this.on("mouseover",this._onMouseOver,this),this.on("mouseout",this._onMouseOut,this)},onRemove:function(e){tomtom.CustomMarker.prototype.onRemove.apply(this,arguments),this.off("mouseover",this._onMouseOver),this.off("mouseout",this._onMouseOut)},configureIcon:function(){var e=this.iconCategory,t=this.incidentType;this.setBackgroundImage("traffic-icons/"+e+"-"+t+".png"),this._icon.id="traffic_incident_"+this._incident.id,e=="cluster"||e=="region"?(L.DomUtil.addClass(this._icon,"trafficIcon-cluster"),this._icon.innerHTML=this.clusterSize,e=="region"&&L.DomUtil.addClass(this._icon,"trafficIcon-region"),this._configureClusterPopup()):this._configurePopup()},setBackgroundImage:function(e){this._icon.style.backgroundImage='url("'+tomtom.baseImagePath+e+'")'},_onMouseOut:function(){L.DomUtil.removeClass(this._icon,"trafficIcon-hover")},_onMouseOver:function(){L.DomUtil.addClass(this._icon,"trafficIcon-hover")},_configurePopup:function(){this.bindPopup(this._getIncidentMarkup(this._incident))},_getIncidentMarkup:function(e){var t=tomtom.baseImagePath,r=new tomtom.StringBundle("IncidentItem"),i=L.Util.extend({r:"",dl:"--",l:"--",d:"",f:"--",t:"--",icon:"url("+t+"traffic-icons/"+tomtom.TrafficMarker.getCategoryString(e.ic)+"-"+tomtom.TrafficMarker.getTypeString(e.ty)+".png)",labelDelay:r.getString("delay"),labelLength:r.getString("length"),labelFrom:r.getString("from"),labelTo:r.getString("to")},e);return i.dl&&!isNaN(i.dl)&&(i.dl=Math.round(i.dl/60),i.dl+=" "+tomtom.StringBundle.getString("units.time.minute",null,i.dl)),i.l&&!isNaN(i.l)&&(i.l=tomtom.StringBundle.getString("units.distance",null,i.l)),L.Util.template(n,i)},_configureClusterPopup:function(){var e=tomtom.baseImagePath,t=0,n="",o=new tomtom.StringBundle("IncidentBalloon.Cluster"),u=this._incident,a=this.pois=u.cpoi.sort(function(e,t){return e.dl>t.dl?-1:e.dl==t.dl?0:1});this._pois=a;for(var f=0;f<a.length&&f<4;f++){var l=a[f],c="";l.f&&l.f.length>s&&(l.f=l.f.substring(0,s)+"..."),l.t&&l.t.length>s&&(l.t=l.t.substring(0,s)+"..."),f+1==a.length&&(c="last");var h=L.Util.extend({r:"",dl:"--",l:"--",d:"",f:"--",t:"--",index:f,className:c,icon:"url("+e+"traffic-icons/"+tomtom.TrafficMarker.getCategoryString(l.ic)+"-"+tomtom.TrafficMarker.getTypeString(l.ty)+".png)"},l);h.dl&&!isNaN(h.dl)&&(h.dl=Math.round(h.dl/60),h.dl+=" "+tomtom.StringBundle.getString("units.time.minute",null,h.dl)),h.l&&!isNaN(h.l)&&(h.l=tomtom.StringBundle.getString("units.distance",null,h.l)),n+=L.Util.template(i,h),t++}var p=L.Util.template(r,{incidentCount:this._incident.cs,labelIncidents:o.getString("title"),mostSevereIncidents:o.getString("listHeader",{count:t},t),orderedBy:o.getString("orderedByDelay"),incidents:n});this.bindPopup(p)},openPopup:function(){tomtom.CustomMarker.prototype.openPopup.apply(this,arguments);var e=L.Util.bind(function(e,t){var n=parseInt(t.getAttribute("data-poi-index"),10),r=null,i=this._pois;isNaN(n)||(r=i[n]),r&&this._showIncidentPopup(r),L.DomEvent.stopPropagation(e)},this),n=t(".trafficInfo-cluster tr",this._popup._contentNode);for(var r=0;r<n.length;r++){var i=n[r];L.DomEvent.on(i,"click",function(t){e(t,this)})}},_showIncidentPopup:function(e){var t=L.point(this.options.popupAnchor)||new L.Point(0,0);t=t.add(L.Popup.prototype.options.offset);var n={offset:t},r=(new L.Popup(n,this)).setContent(this._getIncidentMarkup(e));return r.setLatLng(this._latlng),this._map.openPopup(r),r}}),tomtom.TrafficMarker.getTypeString=function(e){switch(e){case 1:return"minor";case 2:return"moderate";case 3:return"major";default:return"unknown"}},tomtom.TrafficMarker.getCategoryString=function(e){switch(e){case 1:return"accdnt";case 4:return"rain";case 5:return"ice";case 2:case 3:case 10:case 11:case 12:return"block";case 7:case 8:return"closed";case 9:return"rworks";case 13:return"cluster";case 999:return"region";default:return"traffic"}};var n='<div class="trafficInfo"><div class="header"><div style="background-image: {icon}" class="icon"></div><div class="road">{r}</div><div class="delay"><label>{labelDelay}:</label>{dl}</div><div class="length"><label>{labelLength}:</label>{l}</div></div><div class="body"><div class="description">{d}</div><div class="location"><div class="line"><label>{labelFrom}:</label><div>{f}</div></div><div class="line"><label>{labelTo}:</label><div>{t}</div></div></div></div></div>',r='<div class="trafficInfo trafficInfo-cluster"><div class="header">{labelIncidents} {incidentCount}</div><h3>{mostSevereIncidents} <span>{orderedBy}</span></h3><table>{incidents}</table></div>',i='<tr class="{className}" data-poi-index="{index}"><td><div class="icon" style="background-image: {icon}"></div></td><td class="location"><div class="from">{f}</div><div class="to">{t}</div></td><td class="delay">{dl}</td><td class="length">{l}</td>',s=18;return tomtom.TrafficMarker}),define("tomtom/i18n",["./Utils","./Main"],function(e){function l(e,t){if(e&&e.indexOf(".")>-1){var n=e.split("."),r=n.length-1;for(var i=0;i<r&&t;i++)t=t[n[i]];return e=n[i],t&&t[e]||undefined}return t[e]}var t=/{([\w_]+)}/g,n=/^([a-z]{2})([-_])([a-z]{2})/i,r=/;; ?/,i=null,s={},o=null,u="en_US",a={_rules:[[1,function(){return 0}],[2,function(e){return e!=1?1:0}],[2,function(e){return e>1?1:0}],[3,function(e){return e%10==1&&e%100!=11?1:e!==0?2:0}],[4,function(e){return e==1||e==11?0:e==2||e==12?1:e>0&&e<20?2:3}],[3,function(e){return e==1?0:e===0||e%100>0&&e%100<20?1:2}],[3,function(e){return e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?2:1}],[3,function(e){return e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2}],[3,function(e){return e==1?0:e>=2&&e<=4?1:2}],[3,function(e){return e==1?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2}],[4,function(e){return e%100==1?0:e%100==2?1:e%100==3||e%100==4?2:3}],[5,function(e){return e==1?0:e==2?1:e>=3&&e<=6?2:e>=7&&e<=10?3:4}],[6,function(e){return e===0?5:e==1?0:e==2?1:e%100>=3&&e%100<=10?2:e%100>=11&&e%100<=99?3:4}],[4,function(e){return e==1?0:e===0||e%100>0&&e%100<=10?1:e%100>10&&e%100<20?2:3}],[3,function(e){return e%10==1?0:e%10==2?1:2}],[2,function(e){return e%10==1&&e%100!=11?0:1}]],_languages:{"hu-HU":0,"id-ID":0,"ms-MY":0,"th-TH":0,"tr-TR":0,"zh-CN":0,"zh-TW":0,de:1,en:1,es:1,it:1,nl:1,pt:1,"af-ZA":1,"ca-ES":1,"da-DK":1,"de-DE":1,"en-GB":1,"en-US":1,"es-ES":1,"es-MX":1,"it-IT":1,"nl-BE":1,"nl-NL":1,"no-NO":1,"pt-BR":1,"pt-PT":1,"sv-SE":1,"et-EE":1,"fi-FI":1,"bg-BG":1,"el-GR":1,fr:2,"fr-CA":2,"fr-FR":2,"lv-LV":3,"lt-LT":6,"hr-HR":7,"ru-RU":7,"cs-CZ":8,"sk-SK":8,"pl-PL":9,"sl-SI":10},getPluralForm:function(e){var t=a._rules,i;if(isNaN(e)&&"string"==typeof e)if(e in a._languages)i=a._languages[e];else{var s=e.match(n);i=s&&a._languages[s[1]]}else i=Number(e);if(i===null||i===undefined||isNaN(i)||i<0||i>t.length)i=0;var o=t[i][1];return function(e,t){if("string"!=typeof e)return;t=isNaN(t)?1:t<0?0:t;var n=o(t),i=e?e.split(r):[""],s=n<i.length?i[n]:i[i.length-1];return s}}},f={_locale:"",getLocale:function(){return this._locale},setLocale:function(e){this._locale=e,o=a.getPluralForm(this._locale),i=tomtom.languages[this._locale]},getCountryCode:function(){var e=this._locale.match(n);return e&&e[3]||null},getPrimaryLanguage:function(){return this._locale.substr(0,2)},hasLocalizedStrings:function(){return"object"==typeof i&&i!==null&&i!==undefined},setLocaleRule:function(t,n,r){typeof r=="function"&&(e.isArray(t)||(t=[t]),t.forEach(function(e){s[e+"_"+n]=r},this))},getLocaleRule:function(e,t){typeof t=="undefined"&&(t=e,e=this.getLocale());var n=s[e+"_"+t];if(n===null||n===undefined)n=s["*_"+t];return n}},c=L.Class.extend({initialize:function h(e,t){var n={},r,s;t&&(s=t._branch,this._pathKey=t._pathKey?t._pathKey+"."+e:e),s=s||i||h._branch||n,r=s==n?n:l(e,s),this._branch="object"==typeof r?r:null}});c._branch=null,c._pathKey="",c._pluralFormRule=null,c.getBranch=function(e){return new c(e,this)},c.getString=function(e,n,r){var s=this._branch||i||{},u=l(e,s),a=(this._pathKey?this._pathKey+".":"")+e,f=tomtom.LocaleManager.getLocaleRule(a);if(f)return f.apply(this.getBranch(a),[n,r]);var c=this._pluralFormRule||o;return c&&(u=c(u,r)),"string"==typeof u?(n&&(u=u.replace(t,function(e,t){return t in n?n[t]:"#"+t+"#"})),u):"#"+e+"#"},c.prototype._pathKey=c._pathKey,c.prototype._branch=c._branch,c.prototype.getBranch=c.getBranch,c.prototype.getString=c.getString,f.setLocale(u),f.setLocaleRule("*","units.distance",function(e,t){var n=t/1e3;return t<500?t+" "+this.getString("meter",null,t):n.toFixed(1)+" "+this.getString("km",null,n)}),f.setLocaleRule(["en_GB","en_US"],"units.distance",function(e,t){var n=Math.round(t*.10936133)*10,r=n/1760;return r<.5?Math.round(n)+" "+this.getString("yard",null,n):r.toFixed(1)+" "+this.getString("mile",null,r)}),f.setLocaleRule("*","common.TomTom.HDTraffic",function(){return"HD Traffic"}),tomtom.LocaleManager=f,tomtom.StringBundle=c,tomtom.PluralForm=a}),define("tomtom/services/TrafficService",["./BaseService","../AjaxUtil","../Utils","../i18n"],function(e,t,n){tomtom.services.TrafficService=e.extend({initialize:function(){e.prototype.initialize.apply(this,arguments)},getTrafficModel:function(e,i,s,o){typeof s=="function"&&(o=s,s={}),s.projection||(s.projection="EPSG4326");var u=L.Util.extend({},s);s.trafficModelID||(s.trafficModelID=-1),delete u.trafficModelID,u.language||(u.language=tomtom.LocaleManager.getPrimaryLanguage()),s.zoom=i,s.minY=e.top,s.minX=e.left,s.maxY=e.bottom,s.maxX=e.right,this.apiKey&&(u.key=this.apiKey),u.expandCluster=!0;var a=tomtom.services.TrafficService.URL||r;tomtom.logApiCall("trafficModel"),tomtom.proxyUrl?t.getJSON({url:n.getServiceUrl(L.Util.template(a,s),u),callback:o}):t.getJSONP({url:n.getServiceUrl(L.Util.template(a+"p",s),u),callback:o,callbackParam:"jsonp"})}});var r="services/trafficIcons/3/s2/{minY},{minX},{maxY},{maxX}/{zoom}/{trafficModelID}/json";return tomtom.services.TrafficService}),define("tomtom/layers/TrafficIncidentLayer",["../Utils","../lib/leaflet-encoded-polyline","../TrafficMarker","../services/TrafficService"],function(e,t,n){return tomtom.layers.TrafficIncidentLayer=L.LayerGroup.extend({options:{styles:[{stroke:"#ffffff",fill:"#cccccc"},{stroke:"#ff8300",fill:"#ffc700"},{stroke:"#a65500",fill:"#ff8300"},{stroke:"#a60c00",fill:"#ff1300"},{stroke:"#ffffff",fill:"#cccccc"}],lineWidth:8,strokeWidth:2,arrowWidth:16,arrowLength:16},initialize:function(e,t){this.apiKey=e,this.trafficModel=t,this._updateTimeout=0,this._incidents={},L.LayerGroup.prototype.initialize.apply(this,[])},onAdd:function(){L.LayerGroup.prototype.onAdd.apply(this,arguments),this._map.on("zoomanim",this._animateZoom,this)},onRemove:function(){this._map.off("zoomanim",this._animateZoom,this),L.LayerGroup.prototype.onRemove.apply(this,arguments)},update:function(t,n){this.trafficModel=n,clearTimeout(this._updateTimeout),this._updateTimeout=setTimeout(L.Util.bind(function(){typeof t=="undefined"&&(t=!0);var n=this._map,r=n.getZoom(),i=new tomtom.services.TrafficService(this.apiKey),s=this._map.getBounds();if(r>=7){var o=new Date,u={projection:"EPSG4326",trafficModelID:this.trafficModel},a=n.options.useVectorTrafficIncidents;a&&(typeof a=="boolean"?u.geometries="original":u.geometries=a),i.getTrafficModel({top:s.getNorthEast().lat,right:s.getNorthEast().lng,bottom:s.getSouthWest().lat,left:s.getSouthWest().lng},r,u,L.Util.bind(function(t){if(t.tm&&t.tm.poi){var r=this.incidents=t.tm.poi;if(n.options.useVectorTrafficIncidents){var i=L.DomUtil.getPosition(n._mapPane);this._canvas&&this._destroyCanvas(this._canvas),this._canvas=this._createCanvas(),L.DomUtil.setPosition(this._canvas,new L.Point(-i.x,-i.y)),this._currentBounds=n.getBounds(),this._currentZoom=n.getZoom()}if(e.isArray(r))for(var s=0;s<r.length;s++)this._addMarker(r[s],o);else this._addMarker(r,o);this._map.fire("trafficupdate",{incidents:r});for(var u in this._incidents){var a=this._incidents[u];a._trafficIncidentUpdate!=o&&(this.removeLayer(a),delete this._incidents[u])}}else this._canvas&&(this._destroyCanvas(this._canvas),this._canvas=null)},this))}else this.clearLayers(),this._canvas&&(this._destroyCanvas(this._canvas),this._canvas=null)},this),250)},setTrafficModel:function(e){this.trafficModel=e},_addMarker:function(e,r){var i=this._incidents[e.id],s=e.v,o=this._canvas;this._map.options.displayTrafficMarkers?(i===null||i===undefined?(i=new n([e.p.y,e.p.x],e),this.addLayer(i)):(i.setLatLng([e.p.y,e.p.x]),i._incident=e,i._configurePopup()),i._trafficIncidentUpdate=r,this._incidents[e.id]=i):i&&this.removeLayer(i),s&&o&&(this._drawLine(e,t.decode(s),o),this._done=!0)},_drawLine:function(e,t,n){var r=n.getContext("2d"),i=this._map,s=null,o=this.options.styles[e.ty],u=o.stroke,a=o.fill,f=this.options.arrowWidth,l=this.options.arrowLength,c=this.options.lineWidth,h=this.options.strokeWidth,p=i.latLngToContainerPoint(t[t.length-1]),d=i.latLngToContainerPoint(t[t.length-2]);r.beginPath(),s=i.latLngToContainerPoint(L.latLng(t[0])),r.moveTo(s.x,s.y);for(var v=1;v<t.length;v++)s=i.latLngToContainerPoint(t[v]),r.lineTo(s.x,s.y);r.strokeStyle=u,r.lineCap="round",r.lineWidth=c+h*2,r.stroke(),r.strokeStyle=a,r.lineWidth=c,r.stroke(),r.save(),r.beginPath(),r.strokeStyle=u,r.fillStyle=a,r.lineWidth=h*2;var m=p.x-d.x,g=p.y-d.y;r.translate(p.x,p.y),r.rotate(Math.atan2(g,m)),r.moveTo(0,-(f/2)),r.lineTo(l,0),r.lineTo(0,f/2),r.closePath(),r.stroke(),r.fill(),r.beginPath(),r.lineCap="square",r.moveTo(-1,-c/2+h),r.lineTo(-1,c/2-h),r.lineWidth=h*2,r.strokeStyle=a,r.stroke(),r.restore()},_destroyCanvas:function(e){L.DomEvent.off(e,"contextmenu",this._onContextMenu),this._map._panes.overlayPane.removeChild(e)},_createCanvas:function(){var e=this._map,t=e.getSize(),n=document.createElement("canvas");return n.width=t.x,n.height=t.y,n.style.position="absolute",n.style.zIndex=10,n.className="leaflet-zoom-animated",L.DomEvent.on(n,"contextmenu",this._onContextMenu),e._panes.overlayPane.appendChild(n),n},_onContextMenu:function(e){return e.preventDefault(),!1},_animateZoom:function(e){if(!this._canvas||!this._currentBounds)return;var t=this._map,n=t.options.crs,r=this._canvas,i=n.scale(e.zoom)/n.scale(this._currentZoom),s=this._currentBounds,o=s.getNorthWest(),u=s.getSouthEast(),a=t._latLngToNewLayerPoint(o,e.zoom,e.center),f=t._latLngToNewLayerPoint(u,e.zoom,e.center)._subtract(a),l=a._add(f._multiplyBy(.5*(1-1/i)));r.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(l)+" scale("+i+") "}}),tomtom.layers.TrafficIncidentLayer}),L.Control.MiniMap=L.Control.extend({options:{position:"bottomright",toggleDisplay:!1,zoomLevelOffset:-5,zoomLevelFixed:!1,zoomAnimation:!1,width:150,height:150},initialize:function(e,t){L.Util.setOptions(this,t),this._layer=e},onAdd:function(e){return this._mainMap=e,this._container=L.DomUtil.create("div","leaflet-control-minimap"),this._container.style.width=this.options.width+"px",this._container.style.height=this.options.height+"px",L.DomEvent.disableClickPropagation(this._container),L.DomEvent.on(this._container,"mousewheel",L.DomEvent.stopPropagation),this._miniMap=new L.Map(this._container,{attributionControl:!1,zoomControl:!1,zoomAnimation:this.options.zoomAnimation,touchZoom:!this.options.zoomLevelFixed,scrollWheelZoom:!this.options.zoomLevelFixed,doubleClickZoom:!this.options.zoomLevelFixed,boxZoom:!this.options.zoomLevelFixed}),this._miniMap.addLayer(L.Util.clone(this._layer)),this._mainMapMoving=!1,this._miniMapMoving=!1,this.options.toggleDisplay&&this._addToggleButton(),this._miniMap.whenReady(L.Util.bind(function(){this._aimingRect=L.rectangle(this._mainMap.getBounds(),{color:"#ff7800",weight:1,clickable:!1}).addTo(this._miniMap),this._mainMap.on("moveend",this._onMainMapMoved,this),this._mainMap.on("move",this._onMainMapMoving,this),this._miniMap.on("moveend",this._onMiniMapMoved,this)},this)),this._container},addTo:function(e){return L.Control.prototype.addTo.call(this,e),this._miniMap.setView(this._mainMap.getCenter(),this._decideZoom(!0)),this},onRemove:function(e){this._mainMap.off("moveend",this._onMainMapMoved,this),this._mainMap.off("move",this._onMainMapMoving,this),this._miniMap.off("moveend",this._onMiniMapMoved,this)},_addToggleButton:function(){this._toggleDisplayButton=this.options.toggleDisplay?this._createButton("","Hide","leaflet-control-minimap-toggle-display",this._container,this._toggleDisplay,this):undefined,this._minimized=!1},_createButton:function(e,t,n,r,i,s){var o=L.DomUtil.create("a",n,r);o.innerHTML=e,o.href="#",o.title=t;var u=L.DomEvent.stopPropagation;return L.DomEvent.on(o,"click",u).on(o,"mousedown",u).on(o,"dblclick",u).on(o,"click",L.DomEvent.preventDefault).on(o,"click",i,s),o},_toggleDisplay:function(){this._minimized?(this._container.style.width=this.options.width+"px",this._container.style.height=this.options.height+"px",this._toggleDisplayButton.className=this._toggleDisplayButton.className.replace(/(?:^|\s)minimized(?!\S)/g,""),this._minimized=!1):(this._container.style.width="19px",this._container.style.height="19px",this._toggleDisplayButton.className+=" minimized",this._minimized=!0)},_onMainMapMoved:function(e){this._miniMapMoving?this._miniMapMoving=!1:(this._mainMapMoving=!0,this._miniMap.setView(this._mainMap.getCenter(),this._decideZoom(!0))),this._aimingRect.setBounds(this._mainMap.getBounds())},_onMainMapMoving:function(e){this._aimingRect.setBounds(this._mainMap.getBounds())},_onMiniMapMoved:function(e){this._mainMapMoving?this._mainMapMoving=!1:(this._miniMapMoving=!0,this._mainMap.setView(this._miniMap.getCenter(),this._decideZoom(!1)))},_decideZoom:function(e){return this.options.zoomLevelFixed?e?this.options.zoomLevelFixed:this._mainMap.getZoom():e?this._mainMap.getZoom()+this.options.zoomLevelOffset:this._miniMap.getZoom()-this.options.zoomLevelOffset}}),L.Map.mergeOptions({miniMapControl:!1}),L.Map.addInitHook(function(){this.options.miniMapControl&&(this.miniMapControl=(new L.Control.MiniMap).addTo(this))}),L.control.minimap=function(e){return new L.Control.MiniMap(e)},L.Util.clone=function(e){if(e==null||typeof e!="object")return e;var t=new e.constructor;for(var n in e)t[n]=L.Util.clone(e[n]);return t},define("tomtom/lib/leaflet.minimap",function(){}),define("tomtom/controls/Pan",[],function(){return L.Control.Pan=L.Control.extend({options:{position:"topleft",panOffset:500},onAdd:function(e){var t="leaflet-control-pan",n=L.DomUtil.create("div",t),r=this.options.panOffset;return this._panButton("Up",t+"-up",n,e,new L.Point(0,-r)),this._panButton("Left",t+"-left",n,e,new L.Point(-r,0)),this._panButton("Right",t+"-right",n,e,new L.Point(r,0)),this._panButton("Down",t+"-down",n,e,new L.Point(0,r)),n},_panButton:function(e,t,n,r,i,s){var o=L.DomUtil.create("div",t+"-wrap"+" leaflet-bar",n),u=L.DomUtil.create("a",t,o);return u.href="#",u.title=e,L.DomEvent.on(u,"click",L.DomEvent.stopPropagation).on(u,"click",L.DomEvent.preventDefault).on(u,"click",function(){r.panBy(i)},r).on(u,"dblclick",L.DomEvent.stopPropagation),u}}),L.control.pan=function(e){return new L.Control.Pan(e)},L.Control.Pan}),define("tomtom/controls/ZoomSlider",[],function(){return L.Control.Zoomslider=function(){var e=L.Draggable.extend({initialize:function(e,t,n,r){var i=t*n;L.Draggable.prototype.initialize.call(this,e,e),this._element=e,this._maxValue=t-1,this._k=-n,this._m=i-(n+r)/2,this.on("predrag",function(){this._newPos.x=0,this._newPos.y=this._adjust(this._newPos.y)},this)},_adjust:function(e){var t=Math.round(this._toValue(e));return t=Math.max(0,Math.min(this._maxValue,t)),this._toY(t)},_toY:function(e){return this._k*e+this._m},_toValue:function(e){return(e-this._m)/this._k},setPosition:function(e){L.DomUtil.setPosition(this._element,L.point(0,this._adjust(e)))},setValue:function(e){this.setPosition(this._toY(e))},getValue:function(){return this._toValue(L.DomUtil.getPosition(this._element).y)}}),t=L.Control.extend({options:{position:"topleft",stepHeight:9,knobHeight:5,styleNS:"leaflet-control-zoomslider"},onAdd:function(e){var t=L.DomUtil.create("div",this.options.styleNS+" leaflet-bar");return L.DomEvent.disableClickPropagation(t),this._map=e,this._zoomInButton=this._createZoomButton("in","top",t,this._zoomIn),this._sliderElem=L.DomUtil.create("div",this.options.styleNS+"-slider leaflet-bar-part",t),this._zoomOutButton=this._createZoomButton("out","bottom",t,this._zoomOut),e.on("layeradd layerremove",this._refresh,this).on("zoomend",this._updateSlider,this).on("zoomend",this._updateDisabled,this).whenReady(this._createSlider,this).whenReady(this._createKnob,this).whenReady(this._updateSlider,this).whenReady(this._updateDisabled,this),t},onRemove:function(e){e.off("zoomend",this._updateSlider).off("zoomend",this._updateDisabled).off("layeradd layerremove",this._refresh)},_refresh:function(){if(!this._map||!this._map._container||!this._container)return;this._map.removeControl(this).addControl(this)},_zoomLevels:function(){return this._map.getMaxZoom()-this._map.getMinZoom()+1},_createSlider:function(){var e=this._zoomLevels();if(e==Infinity)return;this._sliderBody=L.DomUtil.create("div",this.options.styleNS+"-slider-body",this._sliderElem),this._sliderBody.style.height=this.options.stepHeight*e+"px",L.DomEvent.on(this._sliderBody,"click",this._onSliderClick,this)},_createKnob:function(){var t,n=this._zoomLevels();if(n==Infinity)return;t=L.DomUtil.create("div",this.options.styleNS+"-slider-knob",this._sliderBody),L.DomEvent.disableClickPropagation(t),this._knob=(new e(t,this._zoomLevels(),this.options.stepHeight,this.options.knobHeight)).on("dragend",this._updateZoom,this),this._knob.enable()},_onSliderClick:function(e){var t=e.touches&&e.touches.length===1?e.touches[0]:e,n=L.DomEvent.getMousePosition(t).y-L.DomUtil.getViewportOffset(this._sliderBody).y;this._knob.setPosition(n),this._updateZoom()},_zoomIn:function(e){this._map.zoomIn(e.shiftKey?3:1)},_zoomOut:function(e){this._map.zoomOut(e.shiftKey?3:1)},_createZoomButton:function(e,t,n,r){var i="leaflet-bar-part",s=this.options.styleNS+"-"+e+" "+i+" "+i+"-"+t,o="Zoom "+e,u=L.DomUtil.create("a",s,n);return u.href="#",u.title=o,L.DomEvent.on(u,"click",L.DomEvent.preventDefault).on(u,"click",r,this),u},_toZoomLevel:function(e){return e+this._map.getMinZoom()},_toSliderValue:function(e){return e-this._map.getMinZoom()},_updateZoom:function(){this._map.setZoom(this._toZoomLevel(this._knob.getValue()))},_updateSlider:function(){this._knob&&this._knob.setValue(this._toSliderValue(this._map.getZoom()))},_updateDisabled:function(){var e=this._map,t=this.options.styleNS+"-disabled";L.DomUtil.removeClass(this._zoomInButton,t),L.DomUtil.removeClass(this._zoomOutButton,t),e.getZoom()===e.getMinZoom()&&L.DomUtil.addClass(this._zoomOutButton,t),e.getZoom()===e.getMaxZoom()&&L.DomUtil.addClass(this._zoomInButton,t)}});return t}(),L.control.zoomslider=function(e){return new L.Control.Zoomslider(e)},L.Control.Zoomslider}),define("tomtom/controls/PanZoomBar",["../Main","./Pan","./ZoomSlider"],function(e,t,n){return tomtom.controls.PanZoomBar=L.Control.extend({options:{position:"topleft"},onAdd:function(e){var r=L.DomUtil.create("div","leaflet-control-pan-zoom");return this._pan=new t,r.appendChild(this._pan.onAdd(e)),this._zoomSlider=new n,r.appendChild(this._zoomSlider.onAdd(e)),r},onRemove:function(e){this._pan.onRemove(e),this._zoomSlider.onRemove(e)}}),tomtom.controls.PanZoomBar}),define("tomtom/controls/ContextMenu",["../Utils","../dom/DomUtil"],function(e,t){return tomtom.controls.ContextMenu=L.Control.extend({includes:L.Mixin.Events,initialize:function(e){this.container=document.createElement("ul"),this._eventHandles=[],this._targetElements=[],this._menuItemNodes=[];if(e.menuItems){this.menuItems=e.menuItems;for(var t=0;t<this.menuItems.length;t++)this.addMenuItem(this.menuItems[t])}this._documentClick=function(e){e.button!=2&&this.hide()},L.DomEvent.on(document,"click",this._documentClick,this)},addMenuItem:function(e){var n=document.createElement("li");n.innerHTML=e.label,L.DomEvent.on(n,"click",function(){this._menuItemClick(e)},this),L.DomEvent.on(n,"mouseover",this._menuItemHover),L.DomEvent.on(n,"mouseout",this._menuItemBlur),this.container.appendChild(n),t.query("li",this.container).removeClass("last"),t.query("li",this.container).removeClass("first"),t.query("li:last-child",this.container).addClass("last"),t.query("li:first-child",this.container).addClass("first"),this._menuItemNodes.push(n)},_menuItemHover:function(){t.addClass(this,"menuItemHover")},_menuItemBlur:function(){t.removeClass(this,"menuItemHover")},_menuItemClick:function(e){var t={menuItem:e,contextMenu:this,x:this.currentX,y:this.currentY,pageX:this.currentX,pageY:this.currentY,clientX:this.currentX,clientY:this.currentY,targetElement:this.currentTargetElement,targetObject:this.currentTargetObject};typeof e.onClick=="function"&&e.onClick(t),this.fire("menuitemclick",t)},addTarget:function(e,t){this._targetElements.indexOf(e)==-1&&(e._ttHandleContextMenu=L.Util.bind(function(n){return this._onContextMenu(n,e,t)},this),L.DomEvent.on(e,"contextmenu",e._ttHandleContextMenu,this))},removeTarget:function(e){var t=-1;this._targetElements.forEach(function(n,r){n==e&&(t=r)}),t!=-1&&this._targetElements.splice(t,1),L.DomEvent.off(e,"contextmenu",e._ttHandleContextMenu,this)},clearTargets:function(){this._targetElements.forEach(function(e){this.removeTarget(e)},this)},setData:function(e){this.data=e},getData:function(){return this.data},onAdd:function(e){this.map=e,t.addClass(this.container,"contextMenu"),e._container.appendChild(this.container),e._contextMenus||(e._contextMenus=[]),e._contextMenus.push(this)},onRemove:function(e){e||(e=this.map),L.DomEvent.off(document,"click",this._documentClick),this._documentClick=null,e._container.removeChild(this.container),this._targetElements.forEach(function(e){this.removeTarget(e)},this),this._menuItemNodes.forEach(function(e){t.off(e,"mouseover",this._menuItemHover),t.off(e,"mouseout",this._menuItemBlur),t.off(e,"click",this._menuItemClick)},this),this._menuItemNodes=[],this.menuItems=[]},hide:function(){t.removeClass(this.container,"contextMenuActive")},_onContextMenu:function(e,n,r){var i=t.offset(this.map._container),s=t.dimensions(this.container),o=t.dimensions(this.map._container),u=e.clientX-i.left,a=e.clientY-i.top;return u+s.outerWidth>o.width&&(u-=s.outerWidth),a+s.outerHeight>o.height&&(a-=s.outerHeight),this.currentX=u,this.currentY=a,t.css(this.container,"left",u+"px"),t.css(this.container,"top",a+"px"),t.addClass(this.container,"contextMenuActive"),L.DomEvent.stop(e),this.currentTargetElement=n,this.currentTargetObject=r,!1}}),tomtom.controls.ContextMenu}),define("tomtom/Map",["./Utils","./dom/DomUtil","./Logger","./services/InitializeService","./services/ViewportService","./services/RoutingService","./services/GeocodingService","./layers/MapLayer","./layers/TrafficLayer","./layers/TrafficIncidentLayer","./lib/leaflet.minimap","./controls/PanZoomBar","./controls/ContextMenu"],function(e,t){tomtom.Map=L.Map.extend({options:{displayTrafficMarkers:!0},initialize:function(t){t||(t={}),this.log=new tomtom.Logger,this.apiKey=tomtom.apiKey,this._copyrightInfo={},this._displayRouteId=0,this._currentAttribution="",this._routeCallQueue=[],this._routeWaypoints=[],this._attributionClickHandlers=[],this.routeStyle=L.Util.extend({color:"#0f0",weight:8,opacity:.6},t.routeStyle),t.apiKey&&(this.apiKey=t.apiKey),t.geocodingService?this.geocodingService=t.geocodingService:this.geocodingService=new tomtom.services.GeocodingService(this.apiKey),t.routingService?this.routingService=t.routingService:this.routingService=new tomtom.services.RoutingService(this.apiKey),t.viewportService&&(this._viewportService=t.viewportService),t.minZoom||(t.minZoom=2),t.maxZoom||(t.maxZoom=17),t.center||(t.center=[0,0]),t.zoom||(t.zoom=2),t.attributionControl=!1;if(t.cookie){typeof t.cookie!="object"&&(t.cookie={}),t.cookie.name||(t.cookie.name="tomtom-map-extent");var n=e.getCookie(t.cookie.name);if(n){var r=n.split(",");if(r.length>=3){var i=r[0].trim(),s=r[1].trim();!isNaN(i)&&!isNaN(s)&&(t.center=new L.LatLng(parseFloat(i),parseFloat(s)),t.zoom=r[2].trim())}}}typeof t.zoomControl=="undefined"&&(t.zoomControl=!1),L.Map.prototype.initialize.apply(this,[t.domNode,t]),this.attributionControl=(new L.Control.Attribution({position:"bottomleft",prefix:""})).addTo(this);var o=new tomtom.services.InitializeService(this.apiKey);o.getCopyrightInfo(L.Util.bind(function(e){var n=e.initializeResponse.copyright;for(var r=0;r<n.length;r++){var i=n[r];i&&(this._copyrightInfo[i["@id"]]=i)}t.displayTraffic?this.setDisplayTraffic(!0):this._updateViewport(!1)},this));if(!t.layers){var u=L.Util.extend({apiKey:this.apiKey},t.baseLayerOptions||{});this._baseLayer=new tomtom.layers.MapLayer(u),this._baseLayer.on("load",this._fireLoad,this),this.addLayer(this._baseLayer)}t.scale&&L.control.scale().addTo(this);if(t.overviewMap){var a={toggleDisplay:!0};typeof t.overviewMap=="object"&&(a=t.overviewMap),this._miniMap=(new L.Control.MiniMap(new tomtom.layers.MapLayer({apiKey:this.apiKey}),a)).addTo(this)}if(t.panZoomBar){var f={};typeof t.panZoomBar=="object"&&(f=t.panZoomBar),this._panZoomBar=new tomtom.controls.PanZoomBar(f),this._panZoomBar.addTo(this)}this._waypointContextMenu=new tomtom.controls.ContextMenu({menuItems:[{label:"Remove waypoint",onClick:L.Util.bind(this._removeWaypoint,this)}]}),this._waypointContextMenu.onAdd(this),this.on("move",this._handleMapMove,this),this.on("zoomend",this._handleZoomChange,this),this.on("mousemove",this._handleMouseMove,this),this.on("mouseup",this._handleMouseUp,this)},setDisplayTraffic:function(e){this._displayTraffic=e,e?(clearInterval(this._trafficUpdateIntervalId),this._updateViewport(!0),this._trafficUpdateIntervalId=setInterval(L.Util.bind(function(){this._updateViewport(!0)},this),n)):(this._trafficLayer&&(this.removeLayer(this._trafficLayer),this._trafficLayer=null),this._trafficIncidentLayer&&(this.removeLayer(this._trafficIncidentLayer),this._trafficIncidentLayer=null),clearInterval(this._trafficUpdateIntervalId))},destroy:function(){clearTimeout(this._viewportUpdateTimeoutId),clearInterval(this._trafficUpdateIntervalId);for(var e in this._layers)this.removeLayer(this._layers[e]);this._contextMenus&&(this._contextMenus.forEach(function(e){e.onRemove(this)},this),this._contextMenus=[],this._waypointContextMenu=null);var n=["dragging","scrollWheelZoom","touchZoom","keyboard","doubleClickZoom","boxZoom"];n.forEach(function(e){this[e]&&this[e].removeHooks()},this),this._container._leaflet=null;var r=this._leaflet_events;for(var i in r){var s=r[i];this.off(i,s.action,s.context)}L.DomEvent.off(this._container,"click",this._onMouseClick,this),r=["dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","contextmenu"];var o,u;for(o=0,u=r.length;o<u;o++)L.DomEvent.off(this._container,r[o],this._fireMouseEvent,this);this.options.trackResize&&L.DomEvent.off(window,"resize",this._onResize,this),L.DomUtil.TRANSITION_END&&L.DomEvent.off(this._mapPane,L.DomUtil.TRANSITION_END,this._catchTransitionEnd),this._destroyAttribution();var a=t.create(this._container);a.empty();var f=this._container.className.split(" ");f.forEach(function(e){e.indexOf("leaflet")===0&&a.removeClass(e)}),a.css("position","")},displayRoute:function(e,t,n){this._isRoutingExecuting?this._routeCallQueue.push({points:e,options:t,callback:n}):(this._isRoutingExecuting=!0,typeof t=="function"&&(n=t,t={}),t=t?t:{},this._currentRouteOptions=t,(typeof t.showLoading=="undefined"||t.showLoading)&&this.displayLoadingMessage("Calculating route..."),this._displayRouteId++,typeof t.checkPoints=="undefined"||t.checkPoints?(this._originalRoutePoints=e,this._routePoints=[],this._waypointsNeedUpdate=!0,this._checkRoutePoints(this._displayRouteId,0,t,n)):this._getRoute(this._displayRouteId,t,typeof t.updateBounds=="undefined"?!0:t.updateBounds,n))},displayRouteInstruction:function(e){if(this._routeLayer){var t=this._currentRoute.instructions.instruction[e];this.setView([t.point.latitude,t.point.longitude],r),L.popup().setLatLng([t.point.latitude,t.point.longitude]).setContent(L.Util.template('<div class="tt-instruction-popup"><img src="{iconUrl}" /><span class="road">{text} {roadNumber} {roadName}</span></div>',{iconUrl:tomtom.baseImagePath+"instructions/"+t.iconPath,roadName:t.roadName,roadNumber:t.roadNumber,text:t.text})).openOn(this)}},clearRouting:function(){this._routeLayer&&(this.removeLayer(this._routeLayer),this._routeLayer=null),this._routeMarkerLayer&&(this.removeLayer(this._routeMarkerLayer),this._routeMarkerLayer=null),this._startMarker=null,this._endMarker=null,this._currentRoute=null,this._routeCallQueue=[],this._routeWaypoints.forEach(function(e){this.removeLayer(e)},this),this._routeWaypoints=[],this._waypointContextMenu.clearTargets()},getCurrentRoute:function(){return this._currentRoute},setContextMenu:function(e){this.contextMenu&&this.contextMenu.onRemove(this),this.contextMenu=e,e.addTarget(this._container,this),e.map||e.onAdd(this)},displayLoadingMessage:function(e){this._loadingBackdrop||(this._loadingBackdrop=L.DomUtil.create("div","loadingBackdrop"),this._container.appendChild(this._loadingBackdrop));if(!this._loadingMessage){this._loadingMessage=L.DomUtil.create("div","loadingMessage"),this._container.appendChild(this._loadingMessage);var n=L.DomUtil.create("div","image");this._loadingMessage.appendChild(n);var r=L.DomUtil.create("div","message");this._loadingMessage.appendChild(r)}t.query(".message",this._loadingMessage).html(e),this._loadingBackdrop.style.display="block",this._loadingMessage.style.display="block",this._loadingMessage.style.top=(this._container.offsetHeight-this._loadingMessage.offsetHeight)/2+"px",this._loadingMessage.style.left=(this._container.offsetWidth-this._loadingMessage.offsetWidth)/2+"px"},hideLoadingMessage:function(){this._loadingBackdrop&&(this._loadingBackdrop.style.display="none"),this._loadingMessage&&(this._loadingMessage.style.display="none")},getTrafficIncidents:function(){return this._trafficIncidentLayer&&this._trafficIncidentLayer.incidents?this._trafficIncidentLayer.incidents:null},getTrafficMarkerByIncidentId:function(e){var t=this._trafficIncidentLayer;if(t)for(var n in t._layers){var r=t._layers[n];if(r._incident.id==e)return r}return null},_checkRoutePoints:function(e,t,n,r){if(this._displayRouteId!=e)return;var i=this._originalRoutePoints[t];if(typeof i=="string"){var s=this.geocodingService;s.geocode(i,L.Util.bind(function(i){if(this._displayRouteId!=e)return;if(i.geoResponse&&i.geoResponse.geoResult){var s=i.geoResponse.geoResult,o=null;s.length!==null&&s.length!==undefined?o=L.latLng([s[0].latitude,s[0].longitude]):o=L.latLng([s.latitude,s.longitude]),this._routePoints.push(o),t>0&&t+1<this._originalRoutePoints.length&&this._addRouteWaypoint(o),t++,t>=this._originalRoutePoints.length?this._getRoute(e,n,r):this._checkRoutePoints(e,t,n,r)}else n.callback&&n.callback({error:"Geocode failed for point "+t})},this))}else if(t>=this._originalRoutePoints.length)this._getRoute(e,n,!0,r);else{var o=L.latLng(this._originalRoutePoints[t]);this._routePoints.push(o),t>0&&t+1<this._originalRoutePoints.length&&this._addRouteWaypoint(o),this._checkRoutePoints(e,t+1,n,r)}},_getRoute:function(e,t,n,r){typeof n=="undefined"&&(n=!0);if(this._displayRouteId!=e)return;var i=this.routingService;this.trafficModel&&(t.trafficModelId=this.trafficModel),t.includeVectorData=!0,i.getRoute(this._getUpdatedRoutePoints(),t,L.Util.bind(function(e){this._displayingRoute=!0;if(e){this._currentRoute=e;if(n&&(typeof t.updateBounds=="undefined"||t.updateBounds)){var i=e.bounds;i&&this.fitBounds([[i.getSouthWest().lat,i.getSouthWest().lng],[i.getNorthEast().lat,i.getNorthEast().lng]])}this._addRouteLayer()}else this.log.error("An error occurred during routing",e),this.hideLoadingMessage();r&&r(e),this.fire("routeend",e),this._displayingRoute=!1},this))},_addRouteLayer:function(){if(this._currentRoute){this._routeLayer&&(this.removeLayer(this._routeLayer),this._routeLayer=null),this._routeMarkerLayer||(this._routeMarkerLayer=L.layerGroup().addTo(this)),this._routeLayer=L.polyline([],this.routeStyle).addTo(this);var e=this._currentRoute.vectorPoints;e&&e.length>0&&(this._routeLayer.setLatLngs(e),this._updateWaypoints()),this._routeLayer.on("mousedown",function(e){if(e.originalEvent.button==2)return;this._currentWaypoint=this._addRouteWaypoint(e.latlng)},this),this._updateRouteMarkers()}this._isRoutingExecuting=!1;if(this._routeCallQueue.length>0){var t=this._routeCallQueue.pop();this.displayRoute(t.points,t.options,t.callback),this._routeCallQueue=[]}else this.hideLoadingMessage()},_addRouteWaypoint:function(e,t){typeof t=="undefined"&&(t=!0);if(this._routeWaypoints.length<3){var n=new tomtom.Marker(e,i);this.addLayer(n),n.setContextMenu(this._waypointContextMenu),L.DomEvent.on(n._icon,"mousedown",function(e){return L.DomEvent.stop(e),this._currentWaypoint=n,!1},this),L.DomEvent.on(n._icon,"dragstart",function(e){return L.DomEvent.stop(e),!1});var r=0,s=null,o=this._getUpdatedRoutePoints();return t?(o.forEach(function(t,n){if(n+1<o.length){var i=o[n+1],u=L.LineUtil.pointToSegmentDistance(new L.Point(e.lat,e.lng),new L.Point(t.lat,t.lng),new L.Point(i.lat,i.lng));if(s===null||s===undefined||u<s)s=u,r=n+1}},this),r>0&&r--,this._routeWaypoints.splice(r,0,n)):this._routeWaypoints.push(n),n}},_removeWaypoint:function(e){this.removeLayer(e.targetObject),this._routeWaypoints.splice(this._routeWaypoints.indexOf(e.targetObject),1);var t=L.Util.extend({showLoading:!1,updateMarkers:!1,updateBounds:!1,checkPoints:!1},this._currentRouteOptions);this.displayRoute([],t),this._waypointContextMenu.removeTarget(e.targetElement)},_handleMouseMove:function(e){if(this._currentWaypoint!==null&&this._currentWaypoint!==undefined){this._currentWaypoint.setLatLng(e.latlng);var t={};return t=L.Util.extend({showLoading:!1,updateMarkers:!1,updateBounds:!1,checkPoints:!1},this._currentRouteOptions),this.displayRoute([],t),L.DomEvent.stop(e),!1}},_getUpdatedRoutePoints:function(){var e=[];return e.push(this._routePoints[0]),this._routeWaypoints.forEach(function(t){e.push(t.getLatLng())},this),e.push(this._routePoints[this._routePoints.length-1]),e},_handleMouseUp:function(){this._currentWaypoint=null,this._waypointsNeedUpdate&&!this._isRoutingExecuting&&this._updateWaypoints()},_updateWaypoints:function(){if(this._currentWaypoint!==null&&this._currentWaypoint!==undefined)return;this._waypointsNeedUpdate=!1,this._routeWaypoints.forEach(function(e){var t=99999999,n=null;this._routeLayer.getLatLngs().some(function(r){var i=r.distanceTo(e.getLatLng());i<t&&(t=i,n=r)}),e.setLatLng(n)},this)},_updateRouteMarkers:function(){var e=this._currentRouteOptions,t=this._currentRoute.instructions;if(t){var n=t[0],r=t[t.length-1],i=!1,s=function(){var e=L.Util.extend({showLoading:!1,updateMarkers:!1,updateBounds:!1},this._currentRouteOptions);this.displayRoute([this._startMarker.getLatLng(),this._endMarker.getLatLng()],e)};this._startMarker?i=!0:(this._startMarker=new tomtom.Marker([n.point.latitude,n.point.longitude],tomtom.Map.MARKER_OPTIONS_ROUTE_START,{draggable:!0}),this._startMarker.on("drag",s,this)),this._endMarker?i=!0:(this._endMarker=new tomtom.Marker([r.point.latitude,r.point.longitude],tomtom.Map.MARKER_OPTIONS_ROUTE_END,{draggable:!0}),this._endMarker.on("drag",s,this));if(i&&typeof e.updateMarkers=="undefined"||e.updateMarkers)this._startMarker.setLatLng([n.point.latitude,n.point.longitude]),this._endMarker.setLatLng([r.point.latitude,r.point.longitude]);this._routeMarkerLayer.addLayer(this._startMarker),this._routeMarkerLayer.addLayer(this._endMarker)}},_updateViewport:function(e){var t=this._viewportService;if(t===null||t===undefined)t=this._viewportService=new tomtom.services.ViewportService(this.apiKey);var n=this.getBounds(),r={top:n.getNorthEast().lat,right:n.getNorthEast().lng,bottom:n.getSouthWest().lat,left:n.getSouthWest().lng};t.getViewportModel(r,this.getZoom(),r,this.getZoom(),{projection:"EPSG4326",copyright:!1},L.Util.bind(function(t){if(t.viewpResp){this._updateAttribution(t.viewpResp);if(this._displayTraffic&&t.viewpResp.trafficState&&t.viewpResp.trafficState["@trafficModelId"]){var n=this.trafficModel=t.viewpResp.trafficState["@trafficModelId"];e?(this.options.useVectorTrafficIncidents?this._trafficLayer&&this.removeLayer(this._trafficLayer):this._trafficLayer===null||this._trafficLayer===undefined?(this._trafficLayer=this._getNewTrafficLayer(n),this.addLayer(this._trafficLayer)):this._trafficLayer.update(n),this._trafficIncidentLayer===null||this._trafficIncidentLayer===undefined?(this._trafficIncidentLayer=this._getNewTrafficIncidentLayer(n),this.addLayer(this._trafficIncidentLayer),this._trafficIncidentLayer.update(!0,n)):this._trafficIncidentLayer.update(!0,n)):this._trafficLayer&&(this._trafficLayer.setTrafficModel(n),this._trafficIncidentLayer.setTrafficModel(n))}}},this))},_getNewTrafficIncidentLayer:function(e){return new tomtom.layers.TrafficIncidentLayer(this.apiKey,e)},_getNewTrafficLayer:function(e){return new tomtom.layers.TrafficLayer(this.apiKey,e)},_registerViewportUpdateTimeout:function(){clearTimeout(this._viewportUpdateTimeoutId),this._viewportUpdateTimeoutId=setTimeout(L.Util.bind(function(){this._trafficIncidentLayer&&this._trafficIncidentLayer.update(!0,this.trafficModelId),this._updateViewport(!1)},this),500)},_fireLoad:function(){this._baseLayer.off("load",this._fireLoad),this.fire("load")},_handleZoomChange:function(){this._addRouteLayer()},_handleMapMove:function(){var t=this.getCenter();this.options.cookie&&e.setCookie(this.options.cookie.name,t.lat+","+t.lng+","+this.getZoom(),this.options.cookieExpirationDays),this._registerViewportUpdateTimeout()},_destroyAttribution:function(){this._attributionClickHandlers.forEach(function(e){t.off(e.element,"click",e.handler)}),this._attributionClickHandlers=[]},_updateAttribution:function(e){this._destroyAttribution(),this._currentAttribution&&this.attributionControl.removeAttribution(this._currentAttribution),this._currentAttribution="";var n=e.copyrightIds.toString().split("^");for(var r=0;r<n.length;r++){var i=this._copyrightInfo[n[r]];i&&(this._currentAttribution+='<a href="javascript:void(0);" data-id="'+i["@id"]+'">'+i.label+"</a> ")}this.attributionControl.addAttribution(this._currentAttribution),t.query("a",this.attributionControl._container).each(function(e){var n=function(n){this._attributionClick(t.attr(e,"data-id"),e,n)};this._attributionClickHandlers.push({element:e,handler:n}),t.on(e,"click",n,this)},this)},_attributionClick:function(e,n,r){if(e){var i=this._copyrightInfo[e];if(i){var s=document.createElement("img");L.DomEvent.on(s,"load",function(){var e=t.create("div","leaflet-popup"),n=t.create("a","leaflet-popup-close-button").html("x").attr("href","#close");e.append(n),e.css("opacity",1);var r=t.create("div","leaflet-popup-content-wrapper");e.append(r);var s=t.create("div","leaflet-popup-content").html('<div class="copyrightInfo"><img src="'+i.logo+'" class="copyrightLogo" />'+i.description+"</div>");r.append(s),this._container.appendChild(e.get());var o=t.dimensions(this._container);e.css("top",(o.height-e.offsetHeight())/2+"px"),e.css("left",(o.width-e.offsetWidth())/2+"px"),n.on("click",function(t){this._container.removeChild(e.get()),L.DomEvent.stop(t)},this)},this),s.src=i.logo,L.DomEvent.stop(r||event)}}}});var n=12e4,r=16,i={iconUrl:"waypoint.png",iconSize:[10,10],iconAnchor:[5,5]};return tomtom.Map.MARKER_LAYER_DEFAULT="DEFAULT",tomtom.Map.MARKER_LAYER_TRAFFIC="TRAFFIC",tomtom.Map.MARKER_OPTIONS_ROUTE_START={iconUrl:"marker_start.png",iconSize:[43,49],iconAnchor:[11,40],popupAnchor:[0,0]},tomtom.Map.MARKER_OPTIONS_ROUTE_END={iconUrl:"marker_finish.png",iconSize:[43,49],iconAnchor:[11,40],popupAnchor:[0,0]},tomtom.Map}),function(e,t,n){L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animateAddingMarkers:!1,spiderfyDistanceMultiplier:1,chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(e){L.Util.setOptions(this,e),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.on(L.FeatureGroup.EVENTS,this._propagateEvent,this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.on(L.FeatureGroup.EVENTS,this._propagateEvent,this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[]},addLayer:function(e){if(e instanceof L.LayerGroup){var t=[];for(var n in e._layers)t.push(e._layers[n]);return this.addLayers(t)}if(!e.getLatLng)return this._nonPointGroup.addLayer(e),this;if(!this._map)return this._needsClustering.push(e),this;if(this.hasLayer(e))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(e,this._maxZoom);var r=e,i=this._map.getZoom();if(e.__parent)while(r.__parent._zoom>=i)r=r.__parent;return this._currentShownBounds.contains(r.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(e,r):this._animationAddLayerNonAnimated(e,r)),this},removeLayer:function(e){if(e instanceof L.LayerGroup){var t=[];for(var n in e._layers)t.push(e._layers[n]);return this.removeLayers(t)}return e.getLatLng?this._map?e.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(e)),this._removeLayer(e,!0),this._featureGroup.hasLayer(e)&&(this._featureGroup.removeLayer(e),e.setOpacity&&e.setOpacity(1)),this):this:(!this._arraySplice(this._needsClustering,e)&&this.hasLayer(e)&&this._needsRemoving.push(e),this):(this._nonPointGroup.removeLayer(e),this)},addLayers:function(e){var t=this._featureGroup,n=this._nonPointGroup,r=this.options.chunkedLoading,i=this.options.chunkInterval,s=this.options.chunkProgress,o,u,a,f;if(this._map){var l=0,c=(new Date).getTime(),h=L.bind(function(){var o=(new Date).getTime();for(;l<e.length;l++){if(r&&l%200===0){var u=(new Date).getTime()-o;if(u>i)break}f=e[l];if(!f.getLatLng){n.addLayer(f);continue}if(this.hasLayer(f))continue;this._addLayer(f,this._maxZoom);if(f.__parent&&f.__parent.getChildCount()===2){var a=f.__parent.getAllChildMarkers(),p=a[0]===f?a[1]:a[0];t.removeLayer(p)}}s&&s(l,e.length,(new Date).getTime()-c),l===e.length?(this._featureGroup.eachLayer(function(e){e instanceof L.MarkerCluster&&e._iconNeedsUpdate&&e._updateIcon()}),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(h,this.options.chunkDelay)},this);h()}else{o=[];for(u=0,a=e.length;u<a;u++){f=e[u];if(!f.getLatLng){n.addLayer(f);continue}if(this.hasLayer(f))continue;o.push(f)}this._needsClustering=this._needsClustering.concat(o)}return this},removeLayers:function(e){var t,n,r,i=this._featureGroup,s=this._nonPointGroup;if(!this._map){for(t=0,n=e.length;t<n;t++)r=e[t],this._arraySplice(this._needsClustering,r),s.removeLayer(r);return this}for(t=0,n=e.length;t<n;t++){r=e[t];if(!r.__parent){s.removeLayer(r);continue}this._removeLayer(r,!0,!0),i.hasLayer(r)&&(i.removeLayer(r),r.setOpacity&&r.setOpacity(1))}return this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),i.eachLayer(function(e){e instanceof L.MarkerCluster&&e._updateIcon()}),this},clearLayers:function(){return this._map||(this._needsClustering=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(e){delete e.__parent}),this._map&&this._generateInitialClusters(),this},getBounds:function(){var e=new L.LatLngBounds;this._topClusterLevel&&e.extend(this._topClusterLevel._bounds);for(var t=this._needsClustering.length-1;t>=0;t--)e.extend(this._needsClustering[t].getLatLng());return e.extend(this._nonPointGroup.getBounds()),e},eachLayer:function(e,t){var n=this._needsClustering.slice(),r;this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(n);for(r=n.length-1;r>=0;r--)e.call(t,n[r]);this._nonPointGroup.eachLayer(e,t)},getLayers:function(){var e=[];return this.eachLayer(function(t){e.push(t)}),e},getLayer:function(e){var t=null;return this.eachLayer(function(n){L.stamp(n)===e&&(t=n)}),t},hasLayer:function(e){if(!e)return!1;var t,n=this._needsClustering;for(t=n.length-1;t>=0;t--)if(n[t]===e)return!0;n=this._needsRemoving;for(t=n.length-1;t>=0;t--)if(n[t]===e)return!1;return!!e.__parent&&e.__parent._group===this||this._nonPointGroup.hasLayer(e)},zoomToShowLayer:function(e,t){var n=function(){if((e._icon||e.__parent._icon)&&!this._inZoomAnimation){this._map.off("moveend",n,this),this.off("animationend",n,this);if(e._icon)t();else if(e.__parent._icon){var r=function(){this.off("spiderfied",r,this),t()};this.on("spiderfied",r,this),e.__parent.spiderfy()}}};e._icon&&this._map.getBounds().contains(e.getLatLng())?t():e.__parent._zoom<this._map.getZoom()?(this._map.on("moveend",n,this),this._map.panTo(e.getLatLng())):(this._map.on("moveend",n,this),this.on("animationend",n,this),this._map.setView(e.getLatLng(),e.__parent._zoom+1),e.__parent.zoomToBounds())},onAdd:function(e){this._map=e;var t,n,r;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";this._featureGroup.onAdd(e),this._nonPointGroup.onAdd(e),this._gridClusters||this._generateInitialClusters();for(t=0,n=this._needsRemoving.length;t<n;t++)r=this._needsRemoving[t],this._removeLayer(r,!0);this._needsRemoving=[],this._zoom=this._map.getZoom(),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),n=this._needsClustering,this._needsClustering=[],this.addLayers(n)},onRemove:function(e){e.off("zoomend",this._zoomEnd,this),e.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),this._hideCoverage(),this._featureGroup.onRemove(e),this._nonPointGroup.onRemove(e),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(e){var t=e;while(t&&!t._icon)t=t.__parent;return t||null},_arraySplice:function(e,t){for(var n=e.length-1;n>=0;n--)if(e[n]===t)return e.splice(n,1),!0},_removeLayer:function(e,t,n){var r=this._gridClusters,i=this._gridUnclustered,s=this._featureGroup,o=this._map;if(t)for(var u=this._maxZoom;u>=0;u--)if(!i[u].removeObject(e,o.project(e.getLatLng(),u)))break;var a=e.__parent,f=a._markers,l;this._arraySplice(f,e);while(a){a._childCount--;if(a._zoom<0)break;t&&a._childCount<=1?(l=a._markers[0]===e?a._markers[1]:a._markers[0],r[a._zoom].removeObject(a,o.project(a._cLatLng,a._zoom)),i[a._zoom].addObject(l,o.project(l.getLatLng(),a._zoom)),this._arraySplice(a.__parent._childClusters,a),a.__parent._markers.push(l),l.__parent=a.__parent,a._icon&&(s.removeLayer(a),n||s.addLayer(l))):(a._recalculateBounds(),(!n||!a._icon)&&a._updateIcon()),a=a.__parent}delete e.__parent},_isOrIsParent:function(e,t){while(t){if(e===t)return!0;t=t.parentNode}return!1},_propagateEvent:function(e){if(e.layer instanceof L.MarkerCluster){if(e.originalEvent&&this._isOrIsParent(e.layer._icon,e.originalEvent.relatedTarget))return;e.type="cluster"+e.type}this.fire(e.type,e)},_defaultIconCreateFunction:function(e){var t=e.getChildCount(),n=" marker-cluster-";return t<10?n+="small":t<100?n+="medium":n+="large",new L.DivIcon({html:"<div><span>"+t+"</span></div>",className:"marker-cluster"+n,iconSize:new L.Point(40,40)})},_bindEvents:function(){var e=this._map,t=this.options.spiderfyOnMaxZoom,n=this.options.showCoverageOnHover,r=this.options.zoomToBoundsOnClick;(t||r)&&this.on("clusterclick",this._zoomOrSpiderfy,this),n&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),e.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(e){var t=this._map;t.getMaxZoom()===t.getZoom()?this.options.spiderfyOnMaxZoom&&e.layer.spiderfy():this.options.zoomToBoundsOnClick&&e.layer.zoomToBounds(),e.originalEvent&&e.originalEvent.keyCode===13&&t._container.focus()},_showCoverage:function(e){var t=this._map;if(this._inZoomAnimation)return;this._shownPolygon&&t.removeLayer(this._shownPolygon),e.layer.getChildCount()>2&&e.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(e.layer.getConvexHull(),this.options.polygonOptions),t.addLayer(this._shownPolygon))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var e=this.options.spiderfyOnMaxZoom,t=this.options.showCoverageOnHover,n=this.options.zoomToBoundsOnClick,r=this._map;(e||n)&&this.off("clusterclick",this._zoomOrSpiderfy,this),t&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),r.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){if(!this._map)return;this._mergeSplitClusters(),this._zoom=this._map._zoom,this._currentShownBounds=this._getExpandedVisibleBounds()},_moveEnd:function(){if(this._inZoomAnimation)return;var e=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,e),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._map._zoom,e),this._currentShownBounds=e;return},_generateInitialClusters:function(){var e=this._map.getMaxZoom(),t=this.options.maxClusterRadius,n=t;typeof t!="function"&&(n=function(){return t}),this.options.disableClusteringAtZoom&&(e=this.options.disableClusteringAtZoom-1),this._maxZoom=e,this._gridClusters={},this._gridUnclustered={};for(var r=e;r>=0;r--)this._gridClusters[r]=new L.DistanceGrid(n(r)),this._gridUnclustered[r]=new L.DistanceGrid(n(r));this._topClusterLevel=new L.MarkerCluster(this,-1)},_addLayer:function(e,t){var n=this._gridClusters,r=this._gridUnclustered,i,s;this.options.singleMarkerMode&&(e.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[e]}}));for(;t>=0;t--){i=this._map.project(e.getLatLng(),t);var o=n[t].getNearObject(i);if(o){o._addChild(e),e.__parent=o;return}o=r[t].getNearObject(i);if(o){var u=o.__parent;u&&this._removeLayer(o,!1);var a=new L.MarkerCluster(this,t,o,e);n[t].addObject(a,this._map.project(a._cLatLng,t)),o.__parent=a,e.__parent=a;var f=a;for(s=t-1;s>u._zoom;s--)f=new L.MarkerCluster(this,s,f),n[s].addObject(f,this._map.project(o.getLatLng(),s));u._addChild(f);for(s=t;s>=0;s--)if(!r[s].removeObject(o,this._map.project(o.getLatLng(),s)))break;return}r[t].addObject(e,i)}this._topClusterLevel._addChild(e),e.__parent=this._topClusterLevel;return},_enqueue:function(e){this._queue.push(e),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var e=0;e<this._queue.length;e++)this._queue[e].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){this._processQueue(),this._zoom<this._map._zoom&&this._currentShownBounds.contains(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,this._map._zoom)):this._zoom>this._map._zoom?(this._animationStart(),this._animationZoomOut(this._zoom,this._map._zoom)):this._moveEnd()},_getExpandedVisibleBounds:function(){if(!this.options.removeOutsideVisibleBounds)return this.getBounds();var e=this._map,t=e.getBounds(),n=t._southWest,r=t._northEast,i=L.Browser.mobile?0:Math.abs(n.lat-r.lat),s=L.Browser.mobile?0:Math.abs(n.lng-r.lng);return new L.LatLngBounds(new L.LatLng(n.lat-i,n.lng-s,!0),new L.LatLng(r.lat+i,r.lng+s,!0))},_animationAddLayerNonAnimated:function(e,t){if(t===e)this._featureGroup.addLayer(e);else if(t._childCount===2){t._addToMap();var n=t.getAllChildMarkers();this._featureGroup.removeLayer(n[0]),this._featureGroup.removeLayer(n[1])}else t._updateIcon()}}),L.MarkerClusterGroup.include(L.DomUtil.TRANSITION?{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_animationZoomIn:function(e,t){var n=this._getExpandedVisibleBounds(),r=this._featureGroup,i;this._topClusterLevel._recursively(n,e,0,function(s){var o=s._latlng,u=s._markers,a;n.contains(o)||(o=null),s._isSingleParent()&&e+1===t?(r.removeLayer(s),s._recursivelyAddChildrenToMap(null,t,n)):(s.setOpacity(0),s._recursivelyAddChildrenToMap(o,t,n));for(i=u.length-1;i>=0;i--)a=u[i],n.contains(a._latlng)||r.removeLayer(a)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(n,t),r.eachLayer(function(e){!(e instanceof L.MarkerCluster)&&e._icon&&e.setOpacity(1)}),this._topClusterLevel._recursively(n,e,t,function(e){e._recursivelyRestoreChildPositions(t)}),this._enqueue(function(){this._topClusterLevel._recursively(n,e,0,function(e){r.removeLayer(e),e.setOpacity(1)}),this._animationEnd()})},_animationZoomOut:function(e,t){this._animationZoomOutSingle(this._topClusterLevel,e-1,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,t,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,e,this._getExpandedVisibleBounds())},_animationZoomOutSingle:function(e,t,n){var r=this._getExpandedVisibleBounds();e._recursivelyAnimateChildrenInAndAddSelfToMap(r,t+1,n);var i=this;this._forceLayout(),e._recursivelyBecomeVisible(r,n),this._enqueue(function(){if(e._childCount===1){var s=e._markers[0];s.setLatLng(s.getLatLng()),s.setOpacity&&s.setOpacity(1)}else e._recursively(r,n,0,function(e){e._recursivelyRemoveChildrenFromMap(r,t+1)});i._animationEnd()})},_animationAddLayer:function(e,t){var n=this,r=this._featureGroup;r.addLayer(e),t!==e&&(t._childCount>2?(t._updateIcon(),this._forceLayout(),this._animationStart(),e._setPos(this._map.latLngToLayerPoint(t.getLatLng())),e.setOpacity(0),this._enqueue(function(){r.removeLayer(e),e.setOpacity(1),n._animationEnd()})):(this._forceLayout(),n._animationStart(),n._animationZoomOutSingle(t,this._map.getMaxZoom(),this._map.getZoom())))},_forceLayout:function(){L.Util.falseFn(t.body.offsetWidth)}}:{_animationStart:function(){},_animationZoomIn:function(e,t){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,e),this._topClusterLevel._recursivelyAddChildrenToMap(null,t,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(e,t){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,e),this._topClusterLevel._recursivelyAddChildrenToMap(null,t,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(e,t){this._animationAddLayerNonAnimated(e,t)}}),L.markerClusterGroup=function(e){return new L.MarkerClusterGroup(e)},L.MarkerCluster=L.Marker.extend({initialize:function(e,t,n,r){L.Marker.prototype.initialize.call(this,n?n._cLatLng||n.getLatLng():new L.LatLng(0,0),{icon:this}),this._group=e,this._zoom=t,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._bounds=new L.LatLngBounds,n&&this._addChild(n),r&&this._addChild(r)},getAllChildMarkers:function(e){e=e||[];for(var t=this._childClusters.length-1;t>=0;t--)this._childClusters[t].getAllChildMarkers(e);for(var n=this._markers.length-1;n>=0;n--)e.push(this._markers[n]);return e},getChildCount:function(){return this._childCount},zoomToBounds:function(){var e=this._childClusters.slice(),t=this._group._map,n=t.getBoundsZoom(this._bounds),r=this._zoom+1,i=t.getZoom(),s;while(e.length>0&&n>r){r++;var o=[];for(s=0;s<e.length;s++)o=o.concat(e[s]._childClusters);e=o}n>r?this._group._map.setView(this._latlng,r):n<=i?this._group._map.setView(this._latlng,i+1):this._group._map.fitBounds(this._bounds)},getBounds:function(){var e=new L.LatLngBounds;return e.extend(this._bounds),e},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(e,t){this._iconNeedsUpdate=!0,this._expandBounds(e),e instanceof L.MarkerCluster?(t||(this._childClusters.push(e),e.__parent=this),this._childCount+=e._childCount):(t||this._markers.push(e),this._childCount++),this.__parent&&this.__parent._addChild(e,!0)},_expandBounds:function(e){var t,n=e._wLatLng||e._latlng;e instanceof L.MarkerCluster?(this._bounds.extend(e._bounds),t=e._childCount):(this._bounds.extend(n),t=1),this._cLatLng||(this._cLatLng=e._cLatLng||n);var r=this._childCount+t;this._wLatLng?(this._wLatLng.lat=(n.lat*t+this._wLatLng.lat*this._childCount)/r,this._wLatLng.lng=(n.lng*t+this._wLatLng.lng*this._childCount)/r):this._latlng=this._wLatLng=new L.LatLng(n.lat,n.lng)},_addToMap:function(e){e&&(this._backupLatlng=this._latlng,this.setLatLng(e)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(e,t,n){this._recursively(e,0,n-1,function(e){var n=e._markers,r,i;for(r=n.length-1;r>=0;r--)i=n[r],i._icon&&(i._setPos(t),i.setOpacity(0))},function(e){var n=e._childClusters,r,i;for(r=n.length-1;r>=0;r--)i=n[r],i._icon&&(i._setPos(t),i.setOpacity(0))})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(e,t,n){this._recursively(e,n,0,function(r){r._recursivelyAnimateChildrenIn(e,r._group._map.latLngToLayerPoint(r.getLatLng()).round(),t),r._isSingleParent()&&t-1===n?(r.setOpacity(1),r._recursivelyRemoveChildrenFromMap(e,t)):r.setOpacity(0),r._addToMap()})},_recursivelyBecomeVisible:function(e,t){this._recursively(e,0,t,null,function(e){e.setOpacity(1)})},_recursivelyAddChildrenToMap:function(e,t,n){this._recursively(n,-1,t,function(r){if(t===r._zoom)return;for(var i=r._markers.length-1;i>=0;i--){var s=r._markers[i];if(!n.contains(s._latlng))continue;e&&(s._backupLatlng=s.getLatLng(),s.setLatLng(e),s.setOpacity&&s.setOpacity(0)),r._group._featureGroup.addLayer(s)}},function(t){t._addToMap(e)})},_recursivelyRestoreChildPositions:function(e){for(var t=this._markers.length-1;t>=0;t--){var n=this._markers[t];n._backupLatlng&&(n.setLatLng(n._backupLatlng),delete n._backupLatlng)}if(e-1===this._zoom)for(var r=this._childClusters.length-1;r>=0;r--)this._childClusters[r]._restorePosition();else for(var i=this._childClusters.length-1;i>=0;i--)this._childClusters[i]._recursivelyRestoreChildPositions(e)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(e,t,n){var r,i;this._recursively(e,-1,t-1,function(e){for(i=e._markers.length-1;i>=0;i--){r=e._markers[i];if(!n||!n.contains(r._latlng))e._group._featureGroup.removeLayer(r),r.setOpacity&&r.setOpacity(1)}},function(e){for(i=e._childClusters.length-1;i>=0;i--){r=e._childClusters[i];if(!n||!n.contains(r._latlng))e._group._featureGroup.removeLayer(r),r.setOpacity&&r.setOpacity(1)}})},_recursively:function(e,t,n,r,i){var s=this._childClusters,o=this._zoom,u,a;if(t>o)for(u=s.length-1;u>=0;u--)a=s[u],e.intersects(a._bounds)&&a._recursively(e,t,n,r,i);else{r&&r(this),i&&this._zoom===n&&i(this);if(n>o)for(u=s.length-1;u>=0;u--)a=s[u],e.intersects(a._bounds)&&a._recursively(e,t,n,r,i)}},_recalculateBounds:function(){var e=this._markers,t=this._childClusters,n;this._bounds=new L.LatLngBounds,delete this._wLatLng;for(n=e.length-1;n>=0;n--)this._expandBounds(e[n]);for(n=t.length-1;n>=0;n--)this._expandBounds(t[n])},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}}),L.DistanceGrid=function(e){this._cellSize=e,this._sqCellSize=e*e,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(e,t){var n=this._getCoord(t.x),r=this._getCoord(t.y),i=this._grid,s=i[r]=i[r]||{},o=s[n]=s[n]||[],u=L.Util.stamp(e);this._objectPoint[u]=t,o.push(e)},updateObject:function(e,t){this.removeObject(e),this.addObject(e,t)},removeObject:function(e,t){var n=this._getCoord(t.x),r=this._getCoord(t.y),i=this._grid,s=i[r]=i[r]||{},o=s[n]=s[n]||[],u,a;delete this._objectPoint[L.Util.stamp(e)];for(u=0,a=o.length;u<a;u++)if(o[u]===e)return o.splice(u,1),a===1&&delete s[n],!0},eachObject:function(e,t){var n,r,i,s,o,u,a,f=this._grid;for(n in f){o=f[n];for(r in o){u=o[r];for(i=0,s=u.length;i<s;i++)a=e.call(t,u[i]),a&&(i--,s--)}}},getNearObject:function(e){var t=this._getCoord(e.x),n=this._getCoord(e.y),r,i,s,o,u,a,f,l,c=this._objectPoint,h=this._sqCellSize,p=null;for(r=n-1;r<=n+1;r++){o=this._grid[r];if(o)for(i=t-1;i<=t+1;i++){u=o[i];if(u)for(s=0,a=u.length;s<a;s++)f=u[s],l=this._sqDist(c[L.Util.stamp(f)],e),l<h&&(h=l,p=f)}}return p},_getCoord:function(e){return Math.floor(e/this._cellSize)},_sqDist:function(e,t){var n=t.x-e.x,r=t.y-e.y;return n*n+r*r}},function(){L.QuickHull={getDistant:function(e,t){var n=t[1].lat-t[0].lat,r=t[0].lng-t[1].lng;return r*(e.lat-t[0].lat)+n*(e.lng-t[0].lng)},findMostDistantPointFromBaseLine:function(e,t){var n=0,r=null,i=[],s,o,u;for(s=t.length-1;s>=0;s--){o=t[s],u=this.getDistant(o,e);if(!(u>0))continue;i.push(o),u>n&&(n=u,r=o)}return{maxPoint:r,newPoints:i}},buildConvexHull:function(e,t){var n=[],r=this.findMostDistantPointFromBaseLine(e,t);return r.maxPoint?(n=n.concat(this.buildConvexHull([e[0],r.maxPoint],r.newPoints)),n=n.concat(this.buildConvexHull([r.maxPoint,e[1]],r.newPoints)),n):[e[0]]},getConvexHull:function(e){var t=!1,n=!1,r=null,i=null,s;for(s=e.length-1;s>=0;s--){var o=e[s];if(t===!1||o.lat>t)r=o,t=o.lat;if(n===!1||o.lat<n)i=o,n=o.lat}var u=[].concat(this.buildConvexHull([i,r],e),this.buildConvexHull([r,i],e));return u}}}(),L.MarkerCluster.include({getConvexHull:function(){var e=this.getAllChildMarkers(),t=[],n,r;for(r=e.length-1;r>=0;r--)n=e[r].getLatLng(),t.push(n);return L.QuickHull.getConvexHull(t)}}),L.MarkerCluster.include({_2PI:Math.PI*2,_circleFootSeparation:25,_circleStartAngle:Math.PI/6,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(this._group._spiderfied===this||this._group._inZoomAnimation)return;var e=this.getAllChildMarkers(),t=this._group,n=t._map,r=n.latLngToLayerPoint(this._latlng),i;this._group._unspiderfy(),this._group._spiderfied=this,e.length>=this._circleSpiralSwitchover?i=this._generatePointsSpiral(e.length,r):(r.y+=10,i=this._generatePointsCircle(e.length,r)),this._animationSpiderfy(e,i)},unspiderfy:function(e){if(this._group._inZoomAnimation)return;this._animationUnspiderfy(e),this._group._spiderfied=null},_generatePointsCircle:function(e,t){var n=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+e),r=n/this._2PI,i=this._2PI/e,s=[],o,u;s.length=e;for(o=e-1;o>=0;o--)u=this._circleStartAngle+o*i,s[o]=(new L.Point(t.x+r*Math.cos(u),t.y+r*Math.sin(u)))._round();return s},_generatePointsSpiral:function(e,t){var n=this._group.options.spiderfyDistanceMultiplier*this._spiralLengthStart,r=this._group.options.spiderfyDistanceMultiplier*this._spiralFootSeparation,i=this._group.options.spiderfyDistanceMultiplier*this._spiralLengthFactor,s=0,o=[],u;o.length=e;for(u=e-1;u>=0;u--)s+=r/n+u*5e-4,o[u]=(new L.Point(t.x+n*Math.cos(s),t.y+n*Math.sin(s)))._round(),n+=this._2PI*i/s;return o},_noanimationUnspiderfy:function(){var e=this._group,t=e._map,n=e._featureGroup,r=this.getAllChildMarkers(),i,s;this.setOpacity(1);for(s=r.length-1;s>=0;s--)i=r[s],n.removeLayer(i),i._preSpiderfyLatlng&&(i.setLatLng(i._preSpiderfyLatlng),delete i._preSpiderfyLatlng),i.setZIndexOffset&&i.setZIndexOffset(0),i._spiderLeg&&(t.removeLayer(i._spiderLeg),delete i._spiderLeg);e._spiderfied=null}}),L.MarkerCluster.include(L.DomUtil.TRANSITION?{SVG_ANIMATION:function(){return t.createElementNS("http://www.w3.org/2000/svg","animate").toString().indexOf("SVGAnimate")>-1}(),_animationSpiderfy:function(e,n){var r=this,i=this._group,s=i._map,o=i._featureGroup,u=s.latLngToLayerPoint(this._latlng),a,f,l,c;for(a=e.length-1;a>=0;a--)f=e[a],f.setOpacity?(f.setZIndexOffset(1e6),f.setOpacity(0),o.addLayer(f),f._setPos(u)):o.addLayer(f);i._forceLayout(),i._animationStart();var h=L.Path.SVG?0:.3,p=L.Path.SVG_NS;for(a=e.length-1;a>=0;a--){c=s.layerPointToLatLng(n[a]),f=e[a],f._preSpiderfyLatlng=f._latlng,f.setLatLng(c),f.setOpacity&&f.setOpacity(1),l=new L.Polyline([r._latlng,c],{weight:1.5,color:"#222",opacity:h}),s.addLayer(l),f._spiderLeg=l;if(!L.Path.SVG||!this.SVG_ANIMATION)continue;var d=l._path.getTotalLength();l._path.setAttribute("stroke-dasharray",d+","+d);var v=t.createElementNS(p,"animate");v.setAttribute("attributeName","stroke-dashoffset"),v.setAttribute("begin","indefinite"),v.setAttribute("from",d),v.setAttribute("to",0),v.setAttribute("dur",.25),l._path.appendChild(v),v.beginElement(),v=t.createElementNS(p,"animate"),v.setAttribute("attributeName","stroke-opacity"),v.setAttribute("attributeName","stroke-opacity"),v.setAttribute("begin","indefinite"),v.setAttribute("from",0),v.setAttribute("to",.5),v.setAttribute("dur",.25),l._path.appendChild(v),v.beginElement()}r.setOpacity(.3);if(L.Path.SVG){this._group._forceLayout();for(a=e.length-1;a>=0;a--)f=e[a]._spiderLeg,f.options.opacity=.5,f._path.setAttribute("stroke-opacity",.5)}setTimeout(function(){i._animationEnd(),i.fire("spiderfied")},200)},_animationUnspiderfy:function(e){var t=this._group,n=t._map,r=t._featureGroup,i=e?n._latLngToNewLayerPoint(this._latlng,e.zoom,e.center):n.latLngToLayerPoint(this._latlng),s=this.getAllChildMarkers(),o=L.Path.SVG&&this.SVG_ANIMATION,u,a,f;t._animationStart(),this.setOpacity(1);for(a=s.length-1;a>=0;a--){u=s[a];if(!u._preSpiderfyLatlng)continue;u.setLatLng(u._preSpiderfyLatlng),delete u._preSpiderfyLatlng,u.setOpacity?(u._setPos(i),u.setOpacity(0)):r.removeLayer(u),o&&(f=u._spiderLeg._path.childNodes[0],f.setAttribute("to",f.getAttribute("from")),f.setAttribute("from",0),f.beginElement(),f=u._spiderLeg._path.childNodes[1],f.setAttribute("from",.5),f.setAttribute("to",0),f.setAttribute("stroke-opacity",0),f.beginElement(),u._spiderLeg._path.setAttribute("stroke-opacity",0))}setTimeout(function(){var e=0;for(a=s.length-1;a>=0;a--)u=s[a],u._spiderLeg&&e++;for(a=s.length-1;a>=0;a--){u=s[a];if(!u._spiderLeg)continue;u.setOpacity&&(u.setOpacity(1),u.setZIndexOffset(0)),e>1&&r.removeLayer(u),n.removeLayer(u._spiderLeg),delete u._spiderLeg}t._animationEnd()},200)}}:{_animationSpiderfy:function(e,t){var n=this._group,r=n._map,i=n._featureGroup,s,o,u,a;for(s=e.length-1;s>=0;s--)a=r.layerPointToLatLng(t[s]),o=e[s],o._preSpiderfyLatlng=o._latlng,o.setLatLng(a),o.setZIndexOffset&&o.setZIndexOffset(1e6),i.addLayer(o),u=new L.Polyline([this._latlng,a],{weight:1.5,color:"#222"}),r.addLayer(u),o._spiderLeg=u;this.setOpacity(.3),n.fire("spiderfied")},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerClusterGroup.include({_spiderfied:null,_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Path.SVG&&!L.Browser.touch&&this._map._initPathRoot()},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy()},_unspiderfyZoomStart:function(){if(!this._map)return;this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(e){if(L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching"))return;this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(e)},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(e){this._spiderfied&&this._spiderfied.unspiderfy(e)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(e){e._spiderLeg&&(this._featureGroup.removeLayer(e),e.setOpacity(1),e.setZIndexOffset(0),this._map.removeLayer(e._spiderLeg),delete e._spiderLeg)}})}(window,document),define("tomtom/lib/leaflet.markercluster-src",function(){}),define("tomtom/MarkerManager",["./Main","./Logger","./lib/leaflet.markercluster-src"],function(e,t){var n=new t;tomtom.MarkerManager=L.Class.extend({initialize:function(e){L.Util.extend(this,e),this.markers=[],this.removedMarkers=[],this.markerMap={},this.animationTimeouts=[],this._completedAnimations=0,this._isMoveEndRegistered=!1,this.previousMarkerIds={},this.animation&&typeof this.animation!="object"&&(this.animation={effect:"fade",duration:r,delay:i}),this.clustering&&typeof this.clustering!="object"&&(this.clustering={}),this.clustering?this.layer=(new L.MarkerClusterGroup(this.clustering)).addTo(this.map):this.layer=(new L.LayerGroup).addTo(this.map),this.map.on("zoomstart",this._zoomStart,this)},addMarker:function(e,t){e.map=this.map,this.markers.push(e),t&&(e.id=t,this.markerMap[t]=e)},getMarkerById:function(e){var t=this.markerMap[e];return t?t:null},clearMarkers:function(){this.previousMarkerIds={},this.removedMarkers=this.markers;for(var e in this.markerMap)this.previousMarkerIds[e]=!0;this.markers=[],this.markerMap={}},removeMarker:function(e){e.id&&delete this.markerMap[e.id];var t=this._getMarkerIndex(e);t>=0&&(this.removedMarkers.push(e),this.markers.splice(t,1))},update:function(e){typeof e=="undefined"&&(e=!0);var t=this.map,n=this.layer;this._isMoveEndRegistered||(this._isMoveEndRegistered=!0,t.on("moveend",this._mapMoveEnd,this)),this._updateLayer(n,e),this.removedMarkers=[]},animateMarker:function(e,t,n,s){if(this.animation&&this.animation.effect){var o="",u={delay:t*(this.animation.delay!==null&&this.animation.delay!==undefined?this.animation.delay:i),duration:this.animation.duration?this.animation.duration:r,callback:s};n&&(o=n=="show"?"In":"Out"),e.animate(this.animation.effect+o,u)}},destroy:function(){var e=this.map,t=this.layer;for(var n=0;n<this.markers.length;n++){var r=this.markers[n];t.removeMarker(r)}e.off("moveend",this._mapMoveEnd),e.off("zoomstart",this._zoomStart)},_getMarkerIndex:function(e){for(var t=0;t<this.markers.length;t++)if(this.markers[t]==e)return t;return null},_updateLayer:function(e,t){var r=this.map.getBounds(),i=new Date,s=this.markers,o;for(var u=0;u<s.length;u++)o=this.markers[u],!o._map&&(r.contains(o.getLatLng())||this.clustering)&&(e.addLayer(o),t&&this.animation&&(!o.id||!this.previousMarkerIds[o.id])&&this.animateMarker(o,u,"show"));for(var a=0;a<this.removedMarkers.length;a++)o=this.removedMarkers[a],e.removeLayer(o);n.debug("Updating markers took "+(new Date-i)+"ms")},_mapMoveEnd:function(){this.update()},_zoomStart:function(){var e=this.markers;for(var t=0;t<e.length;t++)e[t].stopAnimation()}});var r=250,i=0;return tomtom.MarkerManager}),define("tomtom/layers/WMSLayer",["../Utils","../Main"],function(){tomtom.layers.WMSLayer=L.TileLayer.WMS.extend({initialize:function(e,t){L.TileLayer.WMS.prototype.initialize.apply(this,arguments),t.srs&&(this.wmsParams.srs=t.srs)},onAdd:function(e){var t=parseFloat(this.wmsParams.version)>=1.3?"crs":"srs";this.options.srs||(this.wmsParams[t]=e.options.crs.code),L.TileLayer.prototype.onAdd.call(this,e)}})}),define("tomtom/services/LegacyGeocodingService",["./BaseService","../Utils","../AjaxUtil"],function(e,t,n){tomtom.services.LegacyGeocodingService=e.extend({initialize:function(){e.prototype.initialize.apply(this,arguments)},geocode:function(e,i,s){typeof i=="function"&&(s=i,i={});var o={q:e};this.apiKey&&(o.key=this.apiKey),o=L.Util.extend(o,i);var u=tomtom.services.GeocodingService.GEOCODE_URL||r;tomtom.proxyUrl?n.getJSON({url:t.getServiceUrl(u+"/json",o),callback:s}):n.getJSONP({url:t.getServiceUrl(u+"/jsonp",o),callback:s,callbackParam:"jsonp"})},reverseGeocode:function(e,r,s,o){if(isNaN(r)){o=s,s=r;var u=L.latLng(e);e=u.lat,r=u.lng}typeof s=="function"&&(o=s,s={});var a={point:e+","+r,projection:"EPSG4326"};a=L.Util.extend(a,s),this.apiKey&&(a.key=this.apiKey);var f=tomtom.services.GeocodingService.REVERSE_GEOCODE_URL||i;tomtom.proxyUrl?n.getJSON({url:t.getServiceUrl(f,a),callback:o}):n.getJSONP({url:t.getServiceUrl(f+"p",a),callback:o,callbackParam:"jsonp"})}});var r="services/geocode/3/geocode",i="services/reverseGeocode/3/json";return tomtom.services.GeocodingService});