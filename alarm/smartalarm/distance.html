<!DOCTYPE html>
<html>
<head>
    <title>Distance</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
     <link rel="stylesheet" href="smartAlarm.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

    <script src="https://cdn.firebase.com/js/client/2.2.1/firebase.js"></script>

    <script type="text/javascript"
         src="https://maps.google.com/maps/api/js?
                       key=AIzaSyCD9gW0p7LS9Y5gLs8gHCgrV1WplVLU1E8&sensor=false&libraries=places">
    </script>

</head>
<body>
<div class="navbar navbar-default navbar-fixed-top">
    <div class="container-fluid">
        <!-- <ul class="nav navbar-nav navbar-right">
          <li><a href="index.html" id="cancel">done</a></li>
        </ul> -->
        <ul class="nav navbar-nav navbar-left">
          <li><a href="index.html" id="done">Home</a></li>
        </ul>
    </div>
</div>

<div class="spacer200"></div>
<form class="form-horizontal">
  <div class="form-group">
    <label class="col-sm-2 control-label">Location</label>
    <div class="col-sm-10">
      <input type="text" class="form-control" id="origin" placeholder="Enter your origin address">
    </div>
  </div>
  <div class="form-group">
    <label class="col-sm-2 control-label">Destination</label>
    <div class="col-sm-10">
      <input type="text" class="form-control" id="destination" placeholder="Enter your destination address">
    </div>
  </div>
  <div class="form-group">
    <label class="col-sm-2 control-label">Transit mode</label>
    <div class="col-sm-10">
    <select class="form-control" id="transitMode">
        <option value="driving">Driving</option>
        <option value="walking">Walking</option>
        <option value="bicycling">Bicycling</option>
        <option value="transit">Transit</option>
    </select>
    </div>
  </div>
  <!-- <div class="form-group">
    <div class="col-sm-offset-2 col-sm-10">
      <div class="checkbox">
        <label>
          <input type="checkbox"> Traffic options
        </label>
        <label>
          <input type="checkbox"> Traffic options
        </label>
      </div>
    </div>
  </div> -->
  <div class="form-group">
    <div class="col-sm-offset-2 col-sm-10">
      <button type="button" id="submit" class="btn btn-default">Calculate</button>
    </div>
  </div>
</form>
<div class="container">
    <div class="row" id="report"></div>
</div>
 <script>
    //Autocomplete drop down options for addresses
  function initialize() {
    var autocomplete1,autocomplete2;
    // Create the autocomplete object, restricting the search
    // to geographical location types.
    autocomplete1 = new google.maps.places.Autocomplete(
    /** @type {HTMLInputElement} */(document.getElementById('origin')),
    { types: ['geocode'] });
    autocomplete2 = new google.maps.places.Autocomplete(
    /** @type {HTMLInputElement} */(document.getElementById('destination')),
    { types: ['geocode'] });
  }
  document.getElementById('origin').onclick=function(){
    initialize();
  };
  document.getElementById('destination').onclick=function(){
    initialize();
  };
  //might want to call window.unload/refresh after ajax finishes
    document.getElementById("submit").onclick= function()
    {
        address1 =document.getElementById("origin").value;
        address2 =document.getElementById("destination").value;
        console.log(address1);
        //traffic data only valid for business customer(find other means)

        //origin:49.260605,-123.245994 -UBC
        //dest:  49.278094,-122.919883 -SFU
        //mode: default to driving
        //language: en -English
        //use of proxy to encode into jsonp format
    var transitMode = document.getElementById("transitMode").value;
        var mapsUrl    = 'https://maps.googleapis.com/maps/api/distancematrix/json?origins='+address1+'&destinations='+address2+'&mode='+transitMode+'&language=en&key=AIzaSyCD9gW0p7LS9Y5gLs8gHCgrV1WplVLU1E8';
        var encodedUrl = encodeURIComponent(mapsUrl);
        var proxyUrl   = 'https://jsonp.afeld.me/?url=' + encodedUrl;
        console.log(mapsUrl);
        $.ajax({
            url: proxyUrl,
            dataType: 'jsonp',
            cache: false,
            success: function (data) {
                console.log(data);
                if(data.status!=='INVALID_REQUEST'){
                    document.getElementById("report").innerText="Distance:"+data.rows[0].elements[0].distance.text+"\nTime:"+data.rows[0].elements[0].duration.text;
                }else{
                    alert('Enter a valid address!');
                }
            },

        });


    };

</script>
</body>
</html>